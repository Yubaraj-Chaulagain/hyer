<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yubaraj Chaulagai Calling Website</title>
<style>
body{font-family:Arial,sans-serif;background:#f2f2f2;margin:0;padding:0;text-align:center}
h1,h2{color:#333;}
.container{max-width:500px;margin:10px auto;padding:20px;}
.box{background:white;padding:20px;margin:15px 0;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
input,button,select{padding:12px;margin:5px;width:90%;max-width:400px;font-size:16px;border-radius:5px;border:1px solid #ccc;box-sizing:border-box;}
button{background:#007bff;color:white;border:none;cursor:pointer;}
button:hover{background:#0056b3;}
#chatbox{height:300px;overflow:auto;border:1px solid gray;padding:10px;text-align:left;background:#f9f9f9;}
iframe{width:100%;height:400px;border:none;border-radius:10px;}
.tabs{display:flex;justify-content:space-around;margin-bottom:10px;}
.tab-btn{flex:1;padding:10px;background:#ddd;cursor:pointer;border-radius:5px;margin:0 2px;}
.tab-btn.active{background:#007bff;color:white;}
@media(max-width:480px){iframe{height:300px;}input,button,select{font-size:14px;padding:10px;}}
</style>
</head>
<body>

<div class="container">
<h1>ЁЯУЮ Yubaraj Chaulagai Calling Website</h1>

<!-- REGISTER FORM -->
<div id="registerForm" class="box">
<h2>рд╕рджрд╕реНрдп рджрд░реНрддрд╛</h2>
<input id="rid" placeholder="Member ID"><br>
<input id="rname" placeholder="рдирд╛рдо"><br>
<input id="remail" placeholder="Email"><br>
<input id="rpass" placeholder="рдкрд╛рд╕рд╡рд░реНрдб"><br>
<button onclick="register()">рджрд░реНрддрд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН</button>
</div>

<!-- LOGIN FORM -->
<div id="loginForm" class="box">
<h2>рд▓рдЧрдЗрди</h2>
<input id="lid" placeholder="Member ID"><br>
<input id="lpass" placeholder="рдкрд╛рд╕рд╡рд░реНрдб"><br>
<button onclick="login()">рд▓рдЧрдЗрди</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none">

<!-- Tabs -->
<div class="tabs">
  <div class="tab-btn active" onclick="showTab('password')">рдкрд╛рд╕рд╡рд░реНрдб рдкрд░рд┐рд╡рд░реНрддрди</div>
  <div class="tab-btn" onclick="showTab('chat')">Live Chat</div>
  <div class="tab-btn" onclick="showTab('call')">Voice/Video Call</div>
</div>

<!-- Password Change -->
<div id="tab-password" class="box tab-content">
<h2>рдкрд╛рд╕рд╡рд░реНрдб рдкрд░рд┐рд╡рд░реНрддрди рдЧрд░реНрдиреБрд╣реЛрд╕реН (OTP verify)</h2>
<input id="passemail" placeholder="Email"><br>
<button onclick="sendOTP()">OTP рдкрдард╛рдЙрдиреБрд╣реЛрд╕реН</button><br>
<input id="otp" placeholder="OTP рдХреЛрдб"><br>
<input id="newpass" placeholder="рдирдпрд╛рдБ рдкрд╛рд╕рд╡рд░реНрдб"><br>
<button onclick="changePassword()">рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓реНрдиреБрд╣реЛрд╕реН</button>
</div>

<!-- Live Chat -->
<div id="tab-chat" class="box tab-content" style="display:none">
<h2>ЁЯТм Live Chat</h2>

<select id="recipient">
  <option value="All">рд╕рд░реНрд╡рд╕рд╛рдзрд╛рд░рдг</option>
  <option value="Saroj">Saroj</option>
  <option value="Sandip">Sandip</option>
  <!-- Add all members here -->
</select><br>

<div id="chatbox"></div>
<input id="msg" placeholder="Message">
<button onclick="send()">Send</button>
</div>

<!-- Voice/Video Call -->
<div id="tab-call" class="box tab-content" style="display:none">
<h2>ЁЯОе Voice/Video Call</h2>
<iframe src="https://p2p.mirotalk.com/YubarajChaulagaiRoom#config.startWithVideoMuted=true"
    allow="camera; microphone; fullscreen;"></iframe>
</div>

</div> <!-- dashboard -->

<script>
const API = "https://script.google.com/macros/s/AKfycbyJFkUcmIGgTvloMzsUxGL4G8AWLtkEm3pWZXi7tYbhuNNBLxGReHiAnA5TJBNy0KgA8g/exec";
let userName = "";
let userID = "";

// TAB SWITCH
function showTab(tab){
  document.querySelectorAll('.tab-content').forEach(el=>el.style.display='none');
  document.getElementById('tab-'+tab).style.display='block';
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

// REGISTER
function register(){
 let data = new URLSearchParams({
  action:"register",
  id:document.getElementById("rid").value,
  name:document.getElementById("rname").value,
  email:document.getElementById("remail").value,
  pass:document.getElementById("rpass").value
 });
 fetch(API,{method:"POST",body:data}).then(res=>res.text()).then(t=>alert(t));
}

// LOGIN
function login(){
 userID = document.getElementById("lid").value;
 let pass = document.getElementById("lpass").value;
 fetch(API,{
   method:"POST",
   body:new URLSearchParams({action:"login",id:userID,pass:pass})
 }).then(res=>res.text())
 .then(tt=>{
   if(tt!="FAIL"){
     userName = tt;
     alert("рд▓рдЧрдЗрди рд╕рдлрд▓ рднрдпреЛ");
     document.getElementById("dashboard").style.display="block";
     document.getElementById("loginForm").style.display="none";
     document.getElementById("registerForm").style.display="none";
     getChat();
   } else alert("рдЧрд▓рдд Member ID рд╡рд╛ рдкрд╛рд╕рд╡рд░реНрдб");
 })
}

// SEND OTP
function sendOTP(){
 let email = document.getElementById("passemail").value;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"sendOTP",email:email})
 }).then(res=>res.text()).then(t=>alert(t));
}

// CHANGE PASSWORD
function changePassword(){
 let otp = document.getElementById("otp").value;
 let email = document.getElementById("passemail").value;
 let newpass = document.getElementById("newpass").value;
 if(newpass.trim()==""){alert("рдкрд╛рд╕рд╡рд░реНрдб рдЦрд╛рд▓реА рдЫ"); return;}
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"verifyOTP",email:email,otp:otp})
 }).then(res=>res.text())
 .then(t=>{
   if(t=="OTP OK"){
     fetch(API,{
       method:"POST",
       body:new URLSearchParams({action:"changePass",id:userID,newpass:newpass})
     }).then(res=>res.text()).then(tt=>alert(tt));
   } else alert("рдЧрд▓рдд OTP");
 })
}

// SEND CHAT
function send(){
 let msg = document.getElementById("msg").value;
 if(msg.trim()=="") return;
 let to = document.getElementById("recipient").value;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"chat",from:userName,to:to,msg:msg})
 }).then(res=>res.text()).then(t=>{
   document.getElementById("msg").value="";
   getChat();
 })
}

// GET CHAT (filter private)
function getChat(){
 fetch(API)
 .then(res=>res.json())
 .then(data=>{
   let html = "";
   data.forEach((row,i)=>{
     if(i===0) return;
     if(row[2]=="All" || row[2]==userName || row[1]==userName){
       html += "<p><b>"+row[1]+":</b> "+row[3]+"</p>";
     }
   });
   document.getElementById("chatbox").innerHTML = html;
   document.getElementById("chatbox").scrollTop = document.getElementById("chatbox").scrollHeight;
 })
}

// AUTO REFRESH CHAT
setInterval(()=>{
  if(document.getElementById("dashboard").style.display=="block") getChat();
},3000);
</script>

</body>
</html>
