<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WhatsApp Style Chat</title>

<style>
body{font-family:sans-serif;background:#ece5dd;margin:0}
header{background:#075e54;color:white;padding:10px}
#chat{height:400px;overflow:auto;padding:10px}
.msg{background:white;padding:6px;margin:6px;border-radius:8px}
.me{background:#dcf8c6;text-align:right}
.typing{font-size:12px;color:gray}
.online{color:lime;font-weight:bold}
</style>
</head>

<body>

<header>
<select id="member"></select>
<span id="status"></span>
</header>

<div id="chat"></div>
<div class="typing" id="typing"></div>

<input id="msg" placeholder="Type message">
<button onclick="send()">Send</button>
<button onclick="voice()">ğŸ¤</button>
<button onclick="startCam()">ğŸ“¹ Start</button>
<button onclick="stopCam()">âŒ Close</button>

<video id="cam" autoplay width="200"></video>

<script>

const API="https://script.google.com/macros/s/AKfycbw5FehQIQh8EVIaWSgQClmWEPRDbvyvPYSE8YRQcKWYpJEVePGXXZZ2z9nfbhcV2QoryA/exec";
const ME=prompt("Your name");
const privateMode = true; // true

async function loadUsers(){
  let r=await fetch(API+"?action=users");
  let users=await r.json();
  member.innerHTML=users.map(u=>`<option>${u}</option>`).join("");
}
loadUsers();

async function send(){
  // âš¡ Private mode check
  if(privateMode && member.value!="Admin") return; // à¤¯à¤¹à¤¾à¤ private mode à¤› à¤­à¤¨à¥‡ public à¤¦à¥‡à¤–à¥à¤¦à¥ˆà¤¨

  await fetch(API+`?action=send&from=${ME}&to=${member.value}&msg=${msg.value}`);
  msg.value="";
}

setInterval(loadMsgs,2000);

async function loadMsgs(){
  let r=await fetch(API+"?action=msgs");
  let data=await r.json();
  chat.innerHTML="";
  data.slice(1).forEach(m=>{
    if((m[1]==ME&&m[2]==member.value)||(m[1]==member.value&&m[2]==ME)){
      chat.innerHTML+=`<div class="msg ${m[1]==ME?"me":""}">
      ${m[3]} ${m[5]?"âœ“âœ“":""}
      </div>`;
    }
  });
}

msg.oninput=()=>fetch(API+`?action=typing&name=${ME}&to=${member.value}`);

async function voice(){
  let stream=await navigator.mediaDevices.getUserMedia({audio:true});
  alert("Voice sent (demo)");
}

let camStream;
async function startCam(){
  camStream=await navigator.mediaDevices.getUserMedia({video:true});
  cam.srcObject=camStream;
}
function stopCam(){
  camStream.getTracks().forEach(t=>t.stop());
}

</script>
</body>
</html>
