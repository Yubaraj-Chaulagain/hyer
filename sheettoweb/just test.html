<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Loan Workflow</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f4f6f9}
.card{border-radius:15px}
</style>
</head>

<body class="p-3">

<div id="loginBox" class="container">
  <div class="card p-4 col-md-4 mx-auto">
    <h4 class="text-center">Login</h4>
    <input id="u" class="form-control my-2" placeholder="Username">
    <input id="p" type="password" class="form-control my-2" placeholder="Password">
    <button class="btn btn-primary w-100" onclick="login()">Login</button>
  </div>
</div>

<div id="system" style="display:none">

<ul class="nav nav-tabs" id="tabs"></ul>

<div class="p-3" id="content"></div>

</div>

<script>

let ROLE="", BRANCH="", STAFF="";

function login(){
  google.script.run.withSuccessHandler(r=>{
    if(!r.status){ alert("Login Failed"); return;}

    ROLE=r.role;
    BRANCH=r.branch;
    STAFF=r.staff;

    document.getElementById("loginBox").style.display="none";
    document.getElementById("system").style.display="block";

    loadTabs();
  }).loginUser(
    document.getElementById("u").value,
    document.getElementById("p").value
  );
}

function loadTabs(){

  let tabs=document.getElementById("tabs");

  if(ROLE=="Staff"){
    tabs.innerHTML=`
      <li class="nav-item"><a class="nav-link active" onclick="newReq()">New Request</a></li>
      <li class="nav-item"><a class="nav-link" onclick="myReq()">My Requests</a></li>
      <li class="nav-item"><a class="nav-link" onclick="disburse()">Disburse Loan</a></li>
    `;
  }

  if(ROLE=="Manager"){
    tabs.innerHTML=`<li class="nav-item"><a class="nav-link active" onclick="manager()">Manager Approve</a></li>`;
  }

  if(ROLE=="Admin"){
    tabs.innerHTML=`<li class="nav-item"><a class="nav-link active" onclick="admin()">Admin Panel</a></li>`;
  }
}

function newReq(){
  document.getElementById("content").innerHTML=`
  <div class="card p-3">
    <h5>New Loan Request</h5>
    <input id="m" class="form-control my-2" placeholder="MemberID">
    <input id="a" class="form-control my-2" placeholder="Amount">
    <input id="mo" class="form-control my-2" placeholder="Months">
    <input id="i" class="form-control my-2" placeholder="Interest">
    <button class="btn btn-success" onclick="saveReq()">Submit</button>
  </div>`;
}

function saveReq(){
  google.script.run.addLoanRequest({
    MemberID:m.value,
    Amount:a.value,
    Months:mo.value,
    Interest:i.value,
    Branch:BRANCH,
    Staff:STAFF
  });
  alert("Request Sent");
}

</script>
</body>
</html>
