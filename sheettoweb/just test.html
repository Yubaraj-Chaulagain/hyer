<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Loan Workflow</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f1f5f9}
.card{border-radius:20px}
</style>
</head>

<body class="p-4">

<div class="container">

<h3 class="text-center mb-3">Loan Workflow System</h3>

<div id="loginBox" class="card p-3">
<input id="code" class="form-control mb-2" placeholder="Code">
<input id="pass" class="form-control mb-2" placeholder="Password">
<button class="btn btn-primary w-100" onclick="login()">Login</button>
</div>

<div id="app" style="display:none">

<ul class="nav nav-tabs mb-3">
<li class="nav-item"><a class="nav-link active" onclick="show('staff')">Staff</a></li>
<li class="nav-item"><a class="nav-link" onclick="show('manager')">Manager</a></li>
<li class="nav-item"><a class="nav-link" onclick="show('admin')">Admin</a></li>
</ul>

<div id="staff" class="tab">
<h5>New Request</h5>
<input id="m" class="form-control mb-2" placeholder="Member">
<input id="a" class="form-control mb-2" placeholder="Amount">
<button class="btn btn-success" onclick="send()">Send</button>

<h5 class="mt-3">My Requests</h5>
<table class="table" id="staffTbl"></table>
  <h5 class="mt-3">Pay EMI</h5>
<input id="loanID" class="form-control mb-2" placeholder="Loan ID">
<button class="btn btn-warning" onclick="pay()">Pay EMI</button>

</div>

<div id="manager" class="tab">
  <h5> Manager Panel</h5>
<h3>ðŸ“Š Dashboard</h3>
<button onclick="loadDash()">Load Dashboard</button>
<div id="dash"></div>

<h3>ðŸ”Ž Member Loan History</h3>
<input id="memberSearch" placeholder="Member ID">
<button onclick="searchMember()">Search</button>
<table id="history"></table>

<h3>ðŸ’° Loan Distributor</h3>
<input id="loanID" placeholder="Loan ID">
<input id="distStaff" placeholder="Staff Code">
<button onclick="distribute()">Assign Distributor</button>
</div>
<div id="admin" class="tab">Admin Panel</div>

</div>

</div>

<script>

const API="https://script.google.com/macros/s/AKfycbxgGyVgnfaWJ5QMk8rI9YRmjRhUxKicJZMJHecByi32mx-WKllz8OfoIRFA1fF7z4qZsw/exec";
let user={};

async function login(){
  let r=await fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"login",
      code:code.value,
      pass:pass.value
    })
  });
  let d=await r.json();

  if(!d.status) return alert("Login Failed");

  user=d;
  loginBox.style.display="none";
  app.style.display="block";
}

async function send(){
  await fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"addRequest",
      member:m.value,
      amount:a.value,
      months:12,
      interest:12,
      branch:user.branch,
      staff:user.code
    })
  });
  alert("Request Sent");
}

function show(id){
  document.querySelectorAll(".tab").forEach(x=>x.style.display="none");
  document.getElementById(id).style.display="block";
}
</script>

</body>
</html>
