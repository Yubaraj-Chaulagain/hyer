<!DOCTYPE html>
<html>
<head>
<title>Dashboard App</title>
<link rel="stylesheet" href="style.css">
<style>
body{font-family:sans-serif;background:#f5f5f5;margin:0;padding:0;}
#login{width:300px;margin:100px auto;background:white;padding:20px;box-shadow:0 0 10px #000;}
input,select{width:100%;margin:5px 0;padding:10px;}
button{width:100%;padding:10px;background:#2196F3;color:white;border:none;}
.card{display:inline-block;padding:20px;background:white;margin:10px;}
table{width:100%;border-collapse:collapse;margin:10px 0;}
th,td{border:1px solid #ccc;padding:8px;}
#loginMsg{color:red;}
</style>
</head>
<body>
<div id="login">
  <h3>Login</h3>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="doLogin()">Login</button>
  <p id="loginMsg"></p>
</div>

<div id="dashboard" style="display:none;">
  <h2>Dashboard</h2>
  <div id="cards"></div>
  <h3>Stock Alerts</h3>
  <div id="stockAlerts"></div>

  <h3>Sell Item</h3>
  <input id="itemID" placeholder="ItemID / QR">
  <input id="quantity" type="number" placeholder="Quantity">
  <input id="memberID" placeholder="MemberID">
  <select id="paymentType"><option>Cash</option><option>Credit</option><option>Loan</option><option>Banking</option></select>
  <button onclick="sellItem()">Sell</button>
  <p id="sellMsg"></p>

  <h3>Reports</h3>
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button onclick="filterReports()">Filter</button>
  <table id="reportTable">
    <thead><tr><th>Date</th><th>Type</th><th>RefID</th><th>Debit</th><th>Credit</th><th>Remark</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<script src="app.js">
const API_URL = 'https://script.google.com/macros/s/AKfycbwzLswgUIBpI1KO17Ss_CI26YpfO2kjiu7B7vzDnkpghCHy3S5U2AGPbf2Vsxb3SM8L/exec';

async function apiPost(funcName,data){
  const res = await fetch(API_URL+'?func='+funcName,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  });
  return res.json();
}

async function doLogin(){
  const username=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  const res = await apiPost('login',{username,password});
  if(res.status){
    document.getElementById('login').style.display='none';
    document.getElementById('dashboard').style.display='block';
    loadDashboard();
  } else document.getElementById('loginMsg').innerText='Invalid username or password';
}

async function loadDashboard(){
  const data = await apiPost('getDashboardData',{});
  let cards=`<div class="card">Members: ${data.Members.length}</div>`;
  cards+=`<div class="card">Users: ${data.Users.length}</div>`;
  cards+=`<div class="card">Loans: ${data.Loan.length}</div>`;
  document.getElementById('cards').innerHTML=cards;
  let alerts=''; data.StockAlert.forEach(s=>alerts+=`<div class="card">${s.ItemID} - ${s.Balance}</div>`);
  document.getElementById('stockAlerts').innerHTML=alerts;
}

async function sellItem(){
  const itemID=document.getElementById('itemID').value;
  const quantity=parseInt(document.getElementById('quantity').value);
  const memberID=document.getElementById('memberID').value;
  const paymentType=document.getElementById('paymentType').value;
  const res = await apiPost('sellItem',{itemID,quantity,memberID,paymentType});
  document.getElementById('sellMsg').innerText=res.status?'Sold! Balance:'+res.balance:res.message;
  loadDashboard();
}

async function filterReports(){
  const fromDate=document.getElementById('fromDate').value;
  const toDate=document.getElementById('toDate').value;
  const data = await apiPost('getReportByDate',{fromDate,toDate});
  let tbody=''; data.forEach(r=>{tbody+=`<tr><td>${r.Date}</td><td>${r.Type}</td><td>${r.RefID}</td><td>${r.Debit}</td><td>${r.Credit}</td><td>${r.Remark}</td></tr>`;});
  document.querySelector('#reportTable tbody').innerHTML=tbody;
}
</script>
</body>
</html>
