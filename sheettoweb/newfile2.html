<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8">
  <title>рд╕рд╣рдХрд╛рд░реА рд╕рджрд╕реНрдп рджрд░реНрддрд╛ рдлрд╛рд░рдо</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container my-4">
<div class="card shadow">
<div class="card-header bg-success text-white text-center">
  <h4 class="mb-0">рд╕рд╣рдХрд╛рд░реА рд╕рджрд╕реНрдп рджрд░реНрддрд╛ рдлрд╛рд░рдо</h4>
</div>

<div class="card-body">
<form id="memberForm" enctype="multipart/form-data">

<!-- 1. Personal -->
<h6 class="text-primary">рез. рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╡рд┐рд╡рд░рдг</h6>
<div class="row mb-3">
  <div class="col-md-2">
    <label class="form-label">рд╕рджрд╕реНрдп рдирдВ.</label>
    <input class="form-control" name="member_no">
  </div>
  <div class="col-md-3">
    <label class="form-label">рдЦрд╛рддрд╛ рдирдВ.</label>
    <input class="form-control" name="member_ac" id="member_id" required>
  </div>
  <div class="col-md-7">
    <label class="form-label">рдкреВрд░рд╛ рдирд╛рдо</label>
    <input class="form-control" name="full_name" required>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-4">
    <label class="form-label">рдмреБрдмрд╛рдХреЛ рдирд╛рдо</label>
    <input class="form-control" name="father_name">
  </div>
  <div class="col-md-4">
    <label class="form-label">рд╣рдЬреБрд░ рдмреБрдмрд╛рдХреЛ рдирд╛рдо</label>
    <input class="form-control" name="grandfather_name">
  </div>
  <div class="col-md-4">
    <label class="form-label">рдкрддрд┐ / рдкрддреНрдиреА</label>
    <input class="form-control" name="spouse_name">
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-4">
    <label class="form-label">рд▓рд┐рдЩреНрдЧ</label>
    <select class="form-select" name="gender">
      <option>рдкреБрд░реБрд╖</option><option>рдорд╣рд┐рд▓рд╛</option><option>рдЕрдиреНрдп</option>
    </select>
  </div>
  <div class="col-md-4">
    <label class="form-label">рдЬрдиреНрдо рдорд┐рддрд┐</label>
    <input type="date" class="form-control" name="dob">
  </div>
  <div class="col-md-4">
    <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдирдВ.</label>
    <input class="form-control" name="citizenship_no">
  </div>
</div>

<!-- 2. Address -->
<h6 class="text-primary mt-4">реи. рдареЗрдЧрд╛рдирд╛</h6>
<div class="row mb-3">
  <div class="col-md-3">
  <label class="form-label">рдкреНрд░рджреЗрд╢</label>
  <select class="form-select" name="province" id="province"></select>
</div>

<div class="col-md-3">
  <label class="form-label">рдЬрд┐рд▓реНрд▓рд╛</label>
  <select class="form-select" name="district" id="district"></select>
</div>

<div class="col-md-3">
  <label class="form-label">рдкрд╛рд▓рд┐рдХрд╛</label>
  <select class="form-select" name="municipality" id="municipality"></select>
</div>
  <div class="col-md-3">
    <label class="form-label">рд╡рдбрд╛ рдирдВ.</label>
    <input class="form-control" name="ward">
  </div>
</div>

<!-- 3. Contact -->
<h6 class="text-primary mt-4">рей. рд╕рдореНрдкрд░реНрдХ рд╡рд┐рд╡рд░рдг</h6>
<div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">рдореЛрдмрд╛рдЗрд▓ рдирдВ.</label>
    <input class="form-control" name="member_mobile">
  </div>
  <div class="col-md-6">
    <label class="form-label">рдИрдореЗрд▓</label>
    <input type="email" class="form-control" name="member_email">
  </div>
</div>
  <!-- 4. member type -->
<h6 class="text-primary mt-4">рен. рд╕рджрд╕реНрдпрдХреЛ рдкреНрд░рдХрд╛рд░</h6>
<div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">рд╕рджрд╕реНрдпрдХреЛ рдкреНрд░рдХрд╛рд░</label>
    <select class="form-select" name="member_type" required>
      <option value="">рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>
      <option>рд╕рд╛рдзрд╛рд░рдг рд╕рджрд╕реНрдп</option>
      <option>рд╕рдВрд╕реНрдерд╛рдкрдХ рд╕рджрд╕реНрдп</option>
      <option>рдЛрдгреА рд╕рджрд╕реНрдп</option>
      <option>рдмрд╛рд▓ рд╕рджрд╕реНрдп</option>
    </select>
  </div>

  <div class="col-md-6">
    <label class="form-label">рд╕реЗрдпрд░ рд╕рдВрдЦреНрдпрд╛</label>
    <input type="number" class="form-control" name="share_count">
  </div>
  <div class="col-md-6">
    <label class="form-label">рд╕рджрд╕реНрдп рд╕реНрдерд┐рддрд┐</label>
    <select class="form-select" name="member_status" required>
      <option value="">рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>
              <option>рд╕рдХреНрд░рд┐рдп</option>
              <option>рдирд┐рд╖реНрдХреНрд░рд┐рдп</option>
    </select>
  </div>
</div>

<!-- 5. Occupation -->
<h6 class="text-primary mt-4">рек. рдкреЗрд╢рд╛ рддрдерд╛ рдЖрдореНрджрд╛рдиреА</h6>
<div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">рдкреЗрд╢рд╛</label>
    <select class="form-select" name="occupation">
      <option>рдХреГрд╖рд┐</option><option>рд╡реНрдпрд╡рд╕рд╛рдп</option><option>рд╕реЗрд╡рд╛</option>
      <option>рд╡реИрджреЗрд╢рд┐рдХ рд░реЛрдЬрдЧрд╛рд░реА</option><option>рдордЬрджреБрд░реА</option>
    </select>
  </div>
  <div class="col-md-6">
    <label class="form-label">рд╡рд╛рд░реНрд╖рд┐рдХ рдЖрдореНрджрд╛рдиреА</label>
    <input type="number" class="form-control" name="annual_income">
  </div>
</div>

<!-- 6. Nominee -->
<h6 class="text-primary mt-4">рел. рд╣рдХрд╡рд╛рд▓рд╛рдХреЛ рд╡рд┐рд╡рд░рдг</h6>

<div class="row mb-3">
  <div class="col-md-4">
    <label class="form-label">рд╣рдХрд╡рд╛рд▓рд╛рдХреЛ рдирд╛рдо</label>
    <input class="form-control" name="nominee_name" required>
  </div>
  <div class="col-md-4">
    <label class="form-label">рд╕рдореНрдмрдиреНрдз</label>
    <input class="form-control" name="nominee_relation">
  </div>
  <div class="col-md-4">
    <label class="form-label">рд╣рдХ рдкреНрд░рддрд┐рд╢рдд (%)</label>
    <input type="number" class="form-control" name="nominee_share">
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-4">
    <label class="form-label">рдореЛрдмрд╛рдЗрд▓ рдирдВ.</label>
    <input class="form-control" name="nominee_mobile">
  </div>
  <div class="col-md-4">
    <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдирдВ.</label>
    <input class="form-control" name="nominee_citizenship_no">
  </div>
  <div class="col-md-4">
  <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдЬрд╛рд░реА рдЬрд┐рд▓реНрд▓рд╛</label>
  <select class="form-select" name="nominee_citizenship_district" id="citizenship_district">
    <option value="">рдЬрд┐рд▓реНрд▓рд╛ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>
  </select>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">рд╣рдХрд╡рд╛рд▓рд╛рдХреЛ рдареЗрдЧрд╛рдирд╛</label>
    <input class="form-control" name="nominee_address">
  </div>
  <div class="col-md-3">
    <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдЕрдЧрд╛рдбрд┐</label>
    <input type="file" class="form-control"
onchange="handleUpload(this,'nominee_front')">
 <input type="hidden" name="nominee_citizenship_front_url" id="nominee_citizenship_front_url">
 </div>
  <div class="col-md-3">
    <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдкрдЫрд╛рдбрд┐</label>
    <input type="file" class="form-control"
onchange="handleUpload(this,'nominee_back')">
    <input type="hidden" name="nominee_citizenship_back_url" id="nominee_citizenship_back_url">
  </div>
</div>


<!-- 7. Documents -->
<h6 class="text-primary mt-4">рем. рдлреЛрдЯреЛ рддрдерд╛ рдХрд╛рдЧрдЬрд╛рдд</h6>
<div class="row mb-3">
  <div class="col-md-4">
    <label class="form-label">рд╕рджрд╕реНрдп рдлреЛрдЯреЛ</label>
    <input type="file" class="form-control" name="photo"
onchange="handleUpload(this,'photo')">
    <input type="hidden" name="photo_url" id="photo_url">

  </div>
  <div class="col-md-4">
    <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдЕрдЧрд╛рдбрд┐</label>
    <input type="file" class="form-control"
onchange="handleUpload(this,'citizen_front')">

    <input type="hidden" name="citizenship_front_url" id="citizenship_front_url">
  </div>
  <div class="col-md-4">
    <label class="form-label">рдирд╛рдЧрд░рд┐рдХрддрд╛ рдкрдЫрд╛рдбрд┐</label>
   <input type="file" class="form-control"
onchange="handleUpload(this,'citizen_back')">
    <input type="hidden" name="citizenship_back_url" id="citizenship_back_url">
  </div>
</div>
  <!-- 8. official use only -->
  <h6 class="text-danger mt-4">7. рдХрд╛рд░реНрдпрд╛рд▓рдпреАрдп рдкреНрд░рдпреЛрдЧ (Office Use Only)</h6>

<div class="row mb-3">
  <div class="col-md-4">
    <label class="form-label">рджрд░реНрддрд╛ рдорд┐рддрд┐</label>
    <input type="date" class="form-control" name="register_date">
  </div>

  <div class="col-md-4">
    <label class="form-label">рд╕реНрд╡реАрдХреГрдд рд╕реНрдерд┐рддрд┐</label>
    <select class="form-select" name="approval_status">
      <option>Pending</option>
      <option>Approved</option>
      <option>Rejected</option>
    </select>
  </div>

  <div class="col-md-4">
    <label class="form-label">Approved By</label>
    <input class="form-control" name="approved_by" placeholder="Chairman / Manager">
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">рдкрдж</label>
    <input class="form-control" name="approved_designation">
  </div>
  <div class="col-md-6">
    <label class="form-label">рдХреИрдлрд┐рдпрдд</label>
    <input class="form-control" name="remarks">
  </div>
</div>


<div class="form-check mt-3">
  <input class="form-check-input" type="checkbox" required>
  <label class="form-check-label">
    рдо рд╕рд╣рдХрд╛рд░реАрдХреЛ рдирд┐рдпрдо рдкрд╛рд▓рдирд╛ рдЧрд░реНрди рд╕рд╣рдордд рдЫреБ
  </label>
</div>

<div class="text-center mt-4">
  <button class="btn btn-success px-5">рджрд░реНрддрд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН</button>
</div>

</form>
</div>
</div>
</div>


  <script>
let addressData = {};

fetch('https://fulkumari.com.np/sheettoweb/nepal-admin-structure.json')
  .then(res => res.json())
  .then(data => {
    addressData = data;
    loadProvinces();
    loadCitizenshipDistricts(); // ЁЯСИ add this
  });

function loadProvinces() {
  const province = document.getElementById('province');
  province.innerHTML = '<option value="">рдкреНрд░рджреЗрд╢ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>';

  for (let p in addressData) {
    province.innerHTML += `<option value="${p}">${p}</option>`;
  }
}

document.getElementById('province').addEventListener('change', function () {
  const district = document.getElementById('district');
  const municipality = document.getElementById('municipality');

  district.innerHTML = '<option value="">рдЬрд┐рд▓реНрд▓рд╛ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>';
  municipality.innerHTML = '<option value="">рдкрд╛рд▓рд┐рдХрд╛ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>';

  if (!this.value) return;

  for (let d in addressData[this.value]) {
    district.innerHTML += `<option value="${d}">${d}</option>`;
  }
});

document.getElementById('district').addEventListener('change', function () {
  const municipality = document.getElementById('municipality');
  municipality.innerHTML = '<option value="">рдкрд╛рд▓рд┐рдХрд╛ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>';

  const province = document.getElementById('province').value;
  if (!this.value) return;

  addressData[province][this.value].forEach(m => {
    municipality.innerHTML += `<option value="${m}">${m}</option>`;
  });
});
</script>
  <script>
function loadCitizenshipDistricts() {
  const districtSelect = document.getElementById('citizenship_district');
  districtSelect.innerHTML = '<option value="">рдЬрд┐рд▓реНрд▓рд╛ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН</option>';

  const added = new Set();

  for (let province in addressData) {
    for (let district in addressData[province]) {
      if (!added.has(district)) {
        added.add(district);
        districtSelect.innerHTML +=
          `<option value="${district}">${district}</option>`;
      }
    }
  }
}
</script>

  <script>
const IMGBB_API_KEY = "f5d95811959fdcd59c8ea459aadb650b";

async function uploadToImgbb(file, rename) {
  const formData = new FormData();
  formData.append("image", file);
  formData.append("name", rename);

  const res = await fetch(
    `https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,
    { method: "POST", body: formData }
  );

  const data = await res.json();
  return data.data.url;
}
</script>

  <script>
async function handleUpload(input, type) {
  const memberId = document.getElementById("member_id").value;
  if (!memberId) {
    alert("рдкрд╣рд┐рд▓реЗ рд╕рджрд╕реНрдп рдирдВ. рд╣рд╛рд▓реНрдиреБрд╣реЛрд╕реН");
    input.value = "";
    return;
  }

  const file = input.files[0];
  let rename = "";

  if (type === "photo") rename = `${memberId}_photo`;
  if (type === "citizen_front") rename = `${memberId}_citizen_front`;
  if (type === "citizen_back") rename = `${memberId}_citizen_back`;
  if (type === "nominee_front") rename = `${memberId}_nominee_citizen_front`;
  if (type === "nominee_back") rename = `${memberId}_nominee_citizen_back`;

  const url = await uploadToImgbb(file, rename);

  if (type === "photo") document.getElementById("photo_url").value = url;
  if (type === "citizen_front") document.getElementById("citizenship_front_url").value = url;
  if (type === "citizen_back") document.getElementById("citizenship_back_url").value = url;
  if (type === "nominee_front") document.getElementById("nominee_citizenship_front_url").value = url;
  if (type === "nominee_back") document.getElementById("nominee_citizenship_back_url").value = url;
}
</script>



</body>
</html>
