<!DOCTYPE html>
<html>
<head>
<title>Member Management System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
.thumb{width:40px;height:40px;object-fit:cover;border-radius:5px}
.hidden{display:none}
</style>
</head>

<body class="p-3">

<!-- LOGIN -->
<div id="loginBox" class="container col-md-4">
<h4>ğŸ” Login</h4>
<input id="user" class="form-control mb-2" placeholder="Username">
<input id="pass" type="password" class="form-control mb-2" placeholder="Password">
<button class="btn btn-primary w-100" onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<h3>ğŸ“Š Dashboard</h3>
<div class="row mb-3">
<div class="col"><div class="card p-2">ğŸ‘¥ Total: <b id="d_total"></b></div></div>
<div class="col"><div class="card p-2">âœ… Active: <b id="d_active"></b></div></div>
<div class="col"><div class="card p-2">âŒ Inactive: <b id="d_inactive"></b></div></div>
</div>

<input id="search" class="form-control mb-2" placeholder="Search">

<button id="addBtn" class="btn btn-success mb-2" onclick="openAdd()">+ Add Member</button>

<table class="table table-bordered table-sm">
<thead class="table-dark">
<tr>
<th>ID</th><th>Name</th><th>Phone</th><th>Status</th>
<th>Photo</th><th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<!-- MODAL -->
<div class="modal fade" id="memberModal">
<div class="modal-dialog modal-xl">
<div class="modal-content">
<div class="modal-header">
<h5 id="modalTitle"></h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body row g-2">

<input id="MemberID" class="form-control col-6" placeholder="Member ID">
<input id="Name" class="form-control col-6" placeholder="Name">
<input id="Address" class="form-control col-6" placeholder="Address">
<input id="FatherName" class="form-control col-6" placeholder="Father Name">
<input id="GrandFatherName" class="form-control col-6" placeholder="Grand Father Name">
<input id="SpouseName" class="form-control col-6" placeholder="Spouse Name">
<input id="Phone" class="form-control col-6" placeholder="Phone">
<input id="Email" class="form-control col-6" placeholder="Email">

<div class="col-6">
<label>Member Photo</label>
<input type="file" class="form-control" onchange="upload(this,'MemberPhoto')">
<img id="p_MemberPhoto" class="thumb mt-1 hidden">
<button class="btn btn-sm btn-danger mt-1" onclick="removeImage('MemberPhoto')">Delete</button>
</div>

<select id="Status" class="form-control col-6">
<option>Active</option>
<option>Inactive</option>
</select>

</div>
<div class="modal-footer">
<button id="saveBtn" class="btn btn-success" onclick="save()">Save</button>
<button id="delBtn" class="btn btn-danger" onclick="del()">Delete</button>
</div>
</div>
</div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbxPUBISUXGn0G2x7muHTOSgG7rH6hU45hlLtDnMbZNPZyg3MfPFqzPgVngd3xLpSVzNBg/exec";
const IMGBB_KEY="f5d95811959fdcd59c8ea459aadb650b";
let role="", members=[], edit=false;
const modal=new bootstrap.Modal(memberModal);

function login(){
fetch(API_URL,{method:"POST",body:JSON.stringify({
action:"login",user:user.value,pass:pass.value
})}).then(r=>r.json()).then(d=>{
if(!d.ok)return alert("Login failed");
role=d.role;
loginBox.classList.add("hidden");
app.classList.remove("hidden");
if(role!=="admin"){
addBtn.style.display="none";
saveBtn.style.display="none";
delBtn.style.display="none";
}
load();
});
}

function load(){
fetch(API_URL).then(r=>r.json()).then(d=>{
members=d;
draw();
dashboard();
});
}

function dashboard(){
d_total.innerText=members.length;
d_active.innerText=members.filter(m=>m.Status=="Active").length;
d_inactive.innerText=members.filter(m=>m.Status=="Inactive").length;
}

function draw(){
tbody.innerHTML="";
members.forEach(m=>{
tbody.innerHTML+=`
<tr>
<td>${m.MemberID}</td>
<td>${m.Name}</td>
<td>${m.Phone}</td>
<td>${m.Status}</td>
<td>${m.MemberPhoto?`<img src="${m.MemberPhoto}" class="thumb">`:""}</td>
<td>
${role=="admin"?`<button class="btn btn-sm btn-warning" onclick='editM(${JSON.stringify(m)})'>Edit</button>`:""}
</td>
</tr>`;
});
}

function openAdd(){edit=false; modal.show();}
function editM(m){
edit=true;
Object.keys(m).forEach(k=>{
if(document.getElementById(k))document.getElementById(k).value=m[k];
if(k=="MemberPhoto"&&m[k]){
p_MemberPhoto.src=m[k];
p_MemberPhoto.classList.remove("hidden");
}
});
modal.show();
}

function save(){
let data={action:edit?"update":"add"};
["MemberID","Name","Address","FatherName","GrandFatherName","SpouseName","Phone","Email","MemberPhoto","Status"]
.forEach(k=>data[k]=document.getElementById(k).value);
fetch(API_URL,{method:"POST",body:JSON.stringify(data)})
.then(()=>{modal.hide();load();});
}

function del(){
fetch(API_URL,{method:"POST",body:JSON.stringify({
action:"delete",MemberID:MemberID.value
})}).then(()=>{modal.hide();load();});
}

function upload(inp,field){
let fd=new FormData();
fd.append("image",inp.files[0]);
fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,{method:"POST",body:fd})
.then(r=>r.json()).then(d=>{
document.getElementById(field).value=d.data.url;
p_MemberPhoto.src=d.data.url;
p_MemberPhoto.classList.remove("hidden");
});
}

function removeImage(field){
document.getElementById(field).value="";
p_MemberPhoto.classList.add("hidden");
}
</script>
</body>
</html>
