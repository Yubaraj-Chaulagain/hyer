<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classic Ludo 2-4 Players</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f0f0f0;
  text-align:center;
}
h2 {margin:10px;}
#board {
  display:grid;
  grid-template-columns:repeat(15,30px);
  grid-template-rows:repeat(15,30px);
  margin:20px auto;
  gap:1px;
}
.cell {
  width:30px;
  height:30px;
  background:#ddd;
  border:1px solid #aaa;
  position:relative;
}
.safe {background:#a8dadc;}
.token {
  width:60%;
  height:60%;
  border-radius:50%;
  position:absolute;
  top:20%;
  left:20%;
}
.red{background:red;}
.green{background:green;}
.yellow{background:gold;}
.blue{background:blue;}
#diceBtn {margin:10px;padding:10px 20px;}
#info {margin:10px;font-weight:bold;}
</style>
</head>
<body>

<h2>Classic Ludo 2-4 Players</h2>
<div id="info"></div>
<button id="diceBtn">Roll Dice</button>
<span id="diceVal">0</span>

<div id="board"></div>

<script>
// ---------------- BOARD SETUP ----------------
const boardSize = 15;
const safeCells = [0,8,13,21,26,34,39,47];
const homeEntry = 57;
const boardEl = document.getElementById("board");
let cells = [];
for(let i=0;i<boardSize*boardSize;i++){
  const c=document.createElement("div");
  c.className="cell";
  c.id="cell"+i;
  boardEl.appendChild(c);
  cells.push(c);
}

// ---------------- PLAYERS ----------------
let players = [
  {name:"Red", color:"red", tokens:[-1,-1,-1,-1]},
  {name:"Green", color:"green", tokens:[-1,-1,-1,-1]},
  {name:"Yellow", color:"yellow", tokens:[-1,-1,-1,-1]},
  {name:"Blue", color:"blue", tokens:[-1,-1,-1,-1]}
];
let currentPlayer = 0;

// ---------------- DICE ----------------
const diceBtn = document.getElementById("diceBtn");
const diceVal = document.getElementById("diceVal");
const infoEl = document.getElementById("info");

function updateInfo(){
  infoEl.innerText=`Current Player: ${players[currentPlayer].name}`;
}
updateInfo();

diceBtn.onclick=function(){
  let d = Math.floor(Math.random()*6)+1;
  diceVal.innerText=d;
  moveToken(d);
}

// ---------------- MOVE TOKEN ----------------
function moveToken(d){
  let player = players[currentPlayer];
  let tokenIndex = player.tokens.findIndex(pos=>pos>=0||pos==-1); // find first movable
  if(tokenIndex==-1 && d!=6) { nextTurn(); return; } 
  if(player.tokens[tokenIndex]==-1 && d==6) player.tokens[tokenIndex]=0;
  else if(player.tokens[tokenIndex]>=0){
    if(player.tokens[tokenIndex]+d>homeEntry){ nextTurn(); return; }
    player.tokens[tokenIndex]+=d;
    if(player.tokens[tokenIndex]==homeEntry) player.tokens[tokenIndex]=-2; // finished
  }
  handleKill(player.color);
  drawTokens();
  checkWinner(player);
  if(d!=6) nextTurn();
}

// ---------------- HANDLE KILL ----------------
function handleKill(color){
  let player = players[currentPlayer];
  let posArr = player.tokens.filter(p=>p>=0);
  for(let i=0;i<players.length;i++){
    if(i==currentPlayer) continue;
    let opp = players[i];
    for(let t=0;t<opp.tokens.length;t++){
      if(posArr.includes(opp.tokens[t]) && !safeCells.includes(opp.tokens[t])){
        opp.tokens[t]=-1; // send back home
      }
    }
  }
}

// ---------------- DRAW TOKENS ----------------
function drawTokens(){
  // clear
  cells.forEach(c=>c.innerHTML="");
  players.forEach(pl=>{
    pl.tokens.forEach(pos=>{
      if(pos>=0){
        const tok = document.createElement("div");
        tok.className="token "+pl.color;
        cells[pos].appendChild(tok);
      }
    });
  });
}

// ---------------- NEXT TURN ----------------
function nextTurn(){
  currentPlayer = (currentPlayer+1)%players.length;
  updateInfo();
}

// ---------------- CHECK WINNER ----------------
function checkWinner(player){
  if(player.tokens.every(t=>t==-2)){
    alert(`${player.name} Wins!`);
    diceBtn.disabled=true;
  }
}

drawTokens();
</script>
</body>
</html>
