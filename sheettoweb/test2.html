<!DOCTYPE html>
<html>
<head>
  <title>Member Management</title>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-3">

<h3>Members</h3>

<input class="form-control mb-2" id="search" placeholder="Searchs">

<table class="table table-bordered table-sm">
<thead>
<tr>
<th>ID</th><th>Name</th><th>Phone</th><th>Status</th><th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<hr>

<h5>Add / Edit</h5>
<input id="MemberID" placeholder="MemberID" class="form-control mb-1">
<input id="Name" placeholder="Name" class="form-control mb-1">
<input id="Phone" placeholder="Phone" class="form-control mb-1">
<input id="Status" placeholder="Status" class="form-control mb-1">

<button class="btn btn-primary" onclick="save()">Save</button>

<script>
const API = "https://script.google.com/macros/s/AKfycby5mzmjn4zZnYauzN5DiC0bOed5YgRL55DxDPAlu_IvUF0ik4ndOTgteK20o4OZNZzf/exec";

let members=[];

fetch(API).then(r=>r.json()).then(d=>{
  members=d; draw(d);
});

function draw(data){
  tbody.innerHTML="";
  data.forEach(m=>{
    tbody.innerHTML+=`
    <tr>
      <td>${m.MemberID}</td>
      <td>${m.Name}</td>
      <td>${m.Phone}</td>
      <td>${m.Status}</td>
      <td>
        <button class="btn btn-sm btn-warning" onclick='edit(${JSON.stringify(m)})'>Edit</button>
        <button class="btn btn-sm btn-danger" onclick="del('${m.MemberID}')">Del</button>
      </td>
    </tr>`;
  });
}

search.onkeyup=()=>{
  const v=search.value.toLowerCase();
  draw(members.filter(m=>
    Object.values(m).join().toLowerCase().includes(v)
  ));
}

function edit(m){
  MemberID.value=m.MemberID;
  Name.value=m.Name;
  Phone.value=m.Phone;
  Status.value=m.Status;
}

function save(){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"update",
      MemberID:MemberID.value,
      Name:Name.value,
      Phone:Phone.value,
      Status:Status.value
    })
  }).then(()=>location.reload());
}

function del(id){
  if(confirm("Delete?")){
    fetch(API,{
      method:"POST",
      body:JSON.stringify({action:"delete",MemberID:id})
    }).then(()=>location.reload());
  }
}
</script>
</body>
</html>
