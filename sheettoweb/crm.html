<!DOCTYPE html>
<html>
<head>
<title>Finance System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="p-3">

<h4>Member Finance System</h4>

<div id="login">
<input id="u" class="form-control mb-2" placeholder="Username">
<input id="p" type="password" class="form-control mb-2" placeholder="Password">
<button class="btn btn-primary" onclick="login()">Login</button>
</div>

<div id="app" style="display:none;">
<ul class="nav nav-tabs mb-3">
<li class="nav-item"><a class="nav-link active" onclick="load('getMembers')">Members</a></li>
<li class="nav-item admin"><a class="nav-link" onclick="load('getUsers')">Users</a></li>
<li class="nav-item"><a class="nav-link" onclick="load('getItems')">Items</a></li>
<li class="nav-item"><a class="nav-link" onclick="load('getTransactions')">Transactions</a></li>
<li class="nav-item"><a class="nav-link" onclick="load('dailyReport')">Daily</a></li>
<li class="nav-item"><a class="nav-link" onclick="load('monthlyReport')">Monthly</a></li>
</ul>

<button class="btn btn-success mb-2" onclick="openAdd()">+ Add</button>
<table class="table table-bordered table-sm" id="tbl"></table>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbyEohqm783728Y4Pws74ocBqiVVx6N7RPd6eDF8gm5M7Ewdtakpq1iipTPWRaXndqIX7A/exec";
let role="";

function login(){
 fetch(API,{method:"POST",body:JSON.stringify({action:"login",username:u.value,password:p.value})})
 .then(r=>r.json()).then(d=>{
  if(!d.status) return alert("Invalid");
  role=d.role;
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="block";
  if(role!=="admin") document.querySelectorAll(".admin").forEach(x=>x.remove());
  load("getMembers");
 });
}

function load(a){
 fetch(API,{method:"POST",body:JSON.stringify({action:a})})
 .then(r=>r.json()).then(draw);
}

function draw(d){
 if(!d.length){tbl.innerHTML="No data";return;}
 let h="<tr>";
 Object.keys(d[0]).forEach(k=>h+=`<th>${k}</th>`);
 h+="</tr>";
 d.forEach(r=>{
  h+="<tr>";
  Object.values(r).forEach(v=>h+=`<td>${v}</td>`);
  h+="</tr>";
 });
 tbl.innerHTML=h;
}

function openAdd(){
 alert("Add/Edit via modal â€“ backend ready");
}

// ===== INVOICE PRINT =====
function printInvoice(txn){
 let w=window.open("");
 w.document.write(`<h3>Invoice</h3><pre>${JSON.stringify(txn,null,2)}</pre>`);
 w.print();
}
</script>
</body>
</html>
