<!DOCTYPE html>
<html>
<head>
<title>Member Finance System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="p-3">

<div id="loginDiv">
<h4>Login</h4>
<input id="u" class="form-control mb-2" placeholder="Username">
<input id="p" type="password" class="form-control mb-2" placeholder="Password">
<button class="btn btn-primary" onclick="login()">Login</button>
</div>

<div id="app" style="display:none">
<h4>Member Finance System</h4>

<button class="btn btn-success mb-2" onclick="openMember()">+ Member</button>
<input id="q" class="form-control mb-2" placeholder="Search Member" onkeyup="search()">

<table class="table table-bordered">
<thead class="table-dark">
<tr><th>ID</th><th>Name</th><th>Phone</th><th>Status</th><th>Action</th></tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<!-- MEMBER MODAL -->
<div class="modal fade" id="memberModal">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header"><h5>Member</h5></div>
<div class="modal-body row g-2">
<input id="MemberID" class="form-control col-6" placeholder="MemberID">
<input id="Name" class="form-control col-6" placeholder="Name">
<input id="Phone" class="form-control col-6" placeholder="Phone">
<input id="Status" class="form-control col-6" placeholder="Status">
</div>
<div class="modal-footer">
<button class="btn btn-success" onclick="saveMember()">Save</button>
<button class="btn btn-danger" onclick="delMember()">Delete</button>
</div>
</div>
</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbxPyRZp6rAKyJj-HLryFOgZ1ehkEY_wNW1XlEX7_C70WG24RXcIZ013RLKsvmiX9JwyMQ/exec";
let edit=false, role="", memberID="";
const mm=new bootstrap.Modal(memberModal);

function login(){
 fetch(API,{method:"POST",body:JSON.stringify({
  action:"login",username:u.value,password:p.value
 })}).then(r=>r.json()).then(d=>{
  if(d.status){
    role=d.role; memberID=d.MemberID;
    loginDiv.style.display="none";
    app.style.display="block";
    loadMembers();
  }
 });
}

function loadMembers(){
 fetch(API,{method:"POST",body:JSON.stringify({action:"getMembers"})})
 .then(r=>r.json()).then(draw);
}

function draw(d){
 tbody.innerHTML="";
 d.forEach(m=>{
  tbody.innerHTML+=`
  <tr>
   <td>${m.MemberID}</td>
   <td>${m.Name}</td>
   <td>${m.Phone}</td>
   <td>${m.Status}</td>
   <td>
    <button class="btn btn-sm btn-warning" onclick='editMember(${JSON.stringify(m)})'>Edit</button>
   </td>
  </tr>`;
 });
}

function openMember(){ edit=false; MemberID.readOnly=false; mm.show(); }
function editMember(m){
 edit=true; MemberID.readOnly=true;
 MemberID.value=m.MemberID; Name.value=m.Name;
 Phone.value=m.Phone; Status.value=m.Status;
 mm.show();
}
function saveMember(){
 fetch(API,{method:"POST",body:JSON.stringify({
  action:edit?"updateMember":"addMember",
  MemberID:MemberID.value,
  Name:Name.value,
  Phone:Phone.value,
  Status:Status.value
 })}).then(()=>{mm.hide();loadMembers();});
}
function delMember(){
 if(!confirm("Delete?"))return;
 fetch(API,{method:"POST",body:JSON.stringify({
  action:"deleteMember",MemberID:MemberID.value
 })}).then(()=>{mm.hide();loadMembers();});
}
function search(){
 fetch(API,{method:"POST",body:JSON.stringify({
  action:"searchMembers",q:q.value
 })}).then(r=>r.json()).then(draw);
}
</script>
</body>
</html>
