<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Loan Request System</title>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;text-align:center;padding:20px}
input,button,select{padding:8px;margin:5px}
table{margin:auto;border-collapse:collapse;width:80%}
th,td{border:1px solid #fff;padding:6px;text-align:center}
button{background:#22c55e;border:none;color:#fff;cursor:pointer}
</style>
</head>
<body>

<h2>Loan Request</h2>

MemberID 
<select id="memberSelect" onchange="updateName()"></select><br>
Name <input id="name" readonly><br>
Amount <input id="amount" type="number"><br>
Months <input id="months" type="number"><br>
Interest % <input id="interest" type="number"><br>
<button onclick="sendRequest()">Send Request</button>

<h2>Manager Panel</h2>
<button onclick="loadPending()">Load Pending</button>
<table id="tbl"></table>

<script>
const URL="YOUR_SCRIPT_URL";
let membersList=[];

// ---------------- Load Members ----------------
function loadMembers(){
  fetch(URL,{method:"POST",body:JSON.stringify({action:"getMembers"})})
  .then(r=>r.json())
  .then(data=>{
    membersList=data;
    const sel=document.getElementById("memberSelect");
    sel.innerHTML="<option value=''>Select Member</option>";
    data.forEach(m=>{
      sel.innerHTML+=`<option value="${m.MemberID}">${m.MemberID}</option>`;
    });
  });
}

// ---------------- Auto Fill Name ----------------
function updateName(){
  const id=document.getElementById("memberSelect").value;
  const m=membersList.find(x=>x.MemberID==id);
  document.getElementById("name").value=m?m.Name:"";
}

// ---------------- Send Loan Request ----------------
function sendRequest(){
  const member=document.getElementById("memberSelect").value;
  if(!member){alert("Select Member"); return;}
  fetch(URL,{method:"POST",body:JSON.stringify({
    action:"addLoanRequest",
    MemberID:member,
    Name:document.getElementById("name").value,
    Amount:amount.value,
    Months:months.value,
    Interest:interest.value,
    RequestedBy:"Staff"
  })}).then(r=>r.json()).then(a=>alert("Request Sent"));
}

// ---------------- Load Pending ----------------
function loadPending(){
  fetch(URL,{method:"POST",body:JSON.stringify({action:"getPending"})})
  .then(r=>r.json())
  .then(list=>{
    let h="<tr><th>ID</th><th>Member</th><th>Name</th><th>Amt</th><th>Action</th></tr>";
    list.forEach(x=>{
      h+=`<tr>
<td>${x.RequestID}</td>
<td>${x.MemberID}</td>
<td>${x.Name}</td>
<td>${x.Amount}</td>
<td>
<button onclick="approve('${x.RequestID}')">Approve</button>
<button onclick="reject('${x.RequestID}')">Reject</button>
</td></tr>`;
    });
    tbl.innerHTML=h;
  });
}

// ---------------- Approve / Reject ----------------
function approve(id){
  fetch(URL,{method:"POST",body:JSON.stringify({action:"managerAction",RequestID:id,approve:true})})
  .then(()=>loadPending());
}

function reject(id){
  fetch(URL,{method:"POST",body:JSON.stringify({action:"managerAction",RequestID:id,approve:false})})
  .then(()=>loadPending());
}

// Load members on page load
loadMembers();
</script>
</body>
</html>
