<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    margin: 0;
    padding: 10px;
  }

  .container {
    max-width: 1200px;
    margin: auto;
    background: #fff;
    padding: 14px 18px;
    border-radius: 8px;
    box-shadow: 0 3px 10px rgba(0,0,0,.08);
  }

  h3 {
    margin: 16px 0 8px;
    padding: 6px 10px;
    background: #2563eb;
    color: #fff;
    font-size: 14px;
    border-radius: 4px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px 12px;
  }

  label {
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 2px;
    display: block;
  }

  input, select, textarea {
    width: 100%;
    padding: 5px 7px;
    font-size: 12px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  textarea {
    resize: none;
    height: 40px;
  }

  .span2 { grid-column: span 2; }
  .span3 { grid-column: span 3; }
  .span4 { grid-column: span 4; }

  button {
    margin-top: 12px;
    width: 100%;
    padding: 8px;
    font-size: 14px;
    background: #2563eb;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  button:hover {
    background: #1e40af;
  }

  @media (max-width: 1024px) {
    .grid { grid-template-columns: repeat(2, 1fr); }
    .span2,.span3,.span4 { grid-column: span 2; }
  }
</style>

</head>
<body>
<div class="container">

<h3>Member Information</h3>
<div class="grid">
  <div>
    <label>Member ID</label>
<input id="MemberID" placeholder="M001" onblur="loadMember()" required>

  </div>

  <div>
    <label>Full Name</label>
    <input id="FullName">
  </div>

  <div>
    <label>Father Name</label>
    <input id="FatherName">
  </div>

  <div>
    <label>Husband / Wife</label>
    <input id="HusbandWifeName">
  </div>

  <div>
    <label>Grandfather Name</label>
    <input id="GrandfatherName">
  </div>

  <div>
    <label>DOB</label>
    <input type="date" id="DOB">
  </div>

  <div>
    <label>Gender</label>
    <select id="Gender">
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
  </div>

  <div>
    <label>Marital Status</label>
    <select id="MaritalStatus">
      <option>Single</option>
      <option>Married</option>
      <option>Widowed</option>
    </select>
  </div>
</div>
<h3>Citizenship</h3>
<div class="grid">
  <div>
    <label>Citizenship No</label>
    <input id="CitizenshipNo">
  </div>

  <div>
    <label>District</label>
    <select id="CitizenshipDistrict"></select>
  </div>

  <div>
    <label>Issue Date</label>
    <input type="date" id="CitizenshipIssueDate">
  </div>

  <div>
    <label>Nationality</label>
    <input id="Nationality" value="Nepali">
  </div>
</div>
<h3>Address</h3>
<div class="grid">
  <div>
    <label>Province</label>
    <select id="Province"></select>
  </div>

  <div>
    <label>District</label>
    <select id="District"></select>
  </div>

  <div>
    <label>Municipality</label>
    <select id="Municipality"></select>
  </div>

  <div>
    <label>Ward No</label>
    <select id="WardNo"></select>
  </div>

  <div class="span4">
    <label>Permanent Address</label>
    <input id="PermanentAddress">
  </div>
</div>
  <h3>Contact & Membership</h3>
<div class="grid">
  <div>
    <label>Mobile</label>
    <input id="Mobile">
  </div>

  <div>
    <label>Email</label>
    <input id="Email">
  </div>

  <div>
    <label>Membership Type</label>
    <select id="MembershipType">
      <option>General</option>
      <option>Saving</option>
      <option>Loan</option>
    </select>
  </div>

  <div>
    <label>Join Date</label>
    <input type="date" id="JoinDate">
  </div>

  <div>
    <label>Share Qty</label>
    <input type="number" id="ShareQty">
  </div>

  <div>
    <label>Share Amount</label>
    <input type="number" id="ShareAmount">
  </div>

  <div>
    <label>Membership Fee</label>
    <input type="number" id="MembershipFee">
  </div>

  <div>
    <label>Member Status</label>
    <select id="MemberStatus">
      <option>Active</option>
      <option>Inactive</option>
    </select>
  </div>
</div>
<h3>Nominee Details</h3>
<div class="grid">
  <div>
    <label>Nominee Name</label>
    <input id="NomineeName">
  </div>

  <div>
    <label>Relation</label>
    <select id="NomineeRelation">
      <option>Father</option>
      <option>Mother</option>
      <option>Spouse</option>
      <option>Son</option>
      <option>Daughter</option>
    </select>
  </div>

  <div>
    <label>Citizenship No</label>
    <input id="NomineeCitizenship">
  </div>

  <div>
    <label>Phone</label>
    <input id="NomineePhone">
  </div>

  <div class="span4">
    <label>Address</label>
    <input id="NomineeAddress">
  </div>
</div>
<h3>Occupation & System</h3>
<div class="grid">
  <div>
    <label>Occupation</label>
    <select id="Occupation">
      <option>Business</option>
      <option>Service</option>
      <option>Agriculture</option>
      <option>Foreign Employment</option>
      <option>Other</option>
    </select>
  </div>

  <div>
    <label>Income Source</label>
    <input id="IncomeSource">
  </div>

  <div>
    <label>Username</label>
    <input id="Username" readonly>
  </div>

  <div>
    <label>Password</label>
    <input id="Password" readonly>
  </div>

  <div class="span4">
    <label>Remarks</label>
    <textarea id="Remarks"></textarea>
  </div>
</div>

<h3>Uploads</h3>
<div class="grid">
  <div>
    <label>Photo</label>
    <input type="file" onchange="upload(this,'PhotoURL')">
    <input id="PhotoURL">
  </div>

  <div>
    <label>Citizenship File</label>
    <input type="file" onchange="upload(this,'CitizenshipFileURL')">
    <input id="CitizenshipFileURL">
  </div>

  <div>
    <label>Signature</label>
    <input type="file" onchange="upload(this,'SignatureURL')">
    <input id="SignatureURL">
  </div>

  <div>
    <label>Role</label>
    <select id="Role">
      <option>Member</option>
      <option>Staff</option>
      <option>Admin</option>
    </select>
  </div>
</div>
  <button onclick="submitForm()">Save</button>
  <button onclick="updateForm()" style="background:#16a34a">Update</button>
  <button onclick="deleteForm()" style="background:#dc2626">Delete</button>
</div>


<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyw0tNKJ4XIjwJIjVspGUISHeLXixKpcE6uGeepbyOj_ZZY_ffL9E2IG8nqx0Dc2mlE_A/exec";
const ADMIN_URL = "https://fulkumari.com.np/sheettoweb/nepal-admin-structure.json";
const IMGBB_KEY = "f5d95811959fdcd59c8ea459aadb650b";
let adminData = {};

const Province = document.getElementById("Province");
const District = document.getElementById("District");
const Municipality = document.getElementById("Municipality");
const CitizenshipDistrict = document.getElementById("CitizenshipDistrict");
const WardNo = document.getElementById("WardNo");

fetch(ADMIN_URL)
  .then(res => res.json())
  .then(data => {
    adminData = data;

    // Province
    Province.innerHTML = `<option value="">Select Province</option>`;
    Object.keys(adminData).forEach(p => {
      Province.innerHTML += `<option value="${p}">${p}</option>`;
    });

    // Citizenship District (ALL 77)
    const districtSet = new Set();
    Object.values(adminData).forEach(prov =>
      Object.keys(prov).forEach(d => districtSet.add(d))
    );

    CitizenshipDistrict.innerHTML = `<option value="">Select District</option>`;
    [...districtSet].sort().forEach(d => {
      CitizenshipDistrict.innerHTML += `<option value="${d}">${d}</option>`;
    });
  });

// Address cascade
Province.onchange = () => {
  District.innerHTML = `<option value="">Select District</option>`;
  Municipality.innerHTML = `<option value="">Select Municipality</option>`;

  if (!Province.value) return;

  Object.keys(adminData[Province.value]).forEach(d => {
    District.innerHTML += `<option value="${d}">${d}</option>`;
  });
};

District.onchange = () => {
  Municipality.innerHTML = `<option value="">Select Municipality</option>`;

  if (!District.value) return;

  adminData[Province.value][District.value].forEach(m => {
    Municipality.innerHTML += `<option value="${m}">${m}</option>`;
  });
};

// Ward 1â€“35
WardNo.innerHTML = `<option value="">Select Ward</option>`;
for (let i = 1; i <= 35; i++) {
  WardNo.innerHTML += `<option value="${i}">${i}</option>`;
}

// IMGBB upload
function upload(input, target) {
  const r = new FileReader();
  r.onloadend = () => {
    fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, {
      method: "POST",
      body: new URLSearchParams({
        image: r.result.split(",")[1]
      })
    })
    .then(res => res.json())
    .then(d => document.getElementById(target).value = d.data.url);
  };
  r.readAsDataURL(input.files[0]);
}

// Submit
function submitForm() {
  if (window.__loadedMember) {
    alert("Already exists. Use UPDATE button.");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "save",
      data: collectData()
    })
  })
  .then(r => r.json())
  .then(res => {
    alert("Member Added");
    clearForm();
  });
}

function loadMember() {
  if (!MemberID.value) return;

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "get",
      memberId: MemberID.value
    })
  })
  .then(r => r.json())
  .then(res => {
    if (!res.found) return alert("Not found");
    Object.entries(res.data).forEach(([k,v])=>{
      if (document.getElementById(k)) document.getElementById(k).value = v;
    });
  });
}


function fillForm(data) {
  Object.keys(data).forEach(k => {
    const el = document.getElementById(k);
    if (el) el.value = data[k];
  });
}

function clearForm() {
  document.querySelectorAll("input,select,textarea")
    .forEach(e => e.value = "");
  window.__loadedMember = null;
}


 function updateForm() {
  if (!window.__loadedMember) {
    alert("Search member first");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "update",
      data: collectData()
    })
  })
  .then(r => r.json())
  .then(res => {
    alert("Member Updated");
  });
}


  
function deleteForm() {
  if (!confirm("Delete member?")) return;

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "delete",
      memberId: MemberID.value
    })
  })
  .then(r => r.json())
  .then(() => alert("Deleted"));
}


  function collectData() {
  const data = {};
  document.querySelectorAll("input,select,textarea")
    .forEach(e => data[e.id] = e.value);
  return data;
}
  
  function searchMember() {
  const id = document.getElementById("MemberID").value.trim();
  if (!id) {
    alert("Enter Member ID");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "get",
      memberId: id
    })
  })
  .then(r => r.json())
  .then(res => {
    if (!res.found) {
      alert("Member not found");
      clearForm();
      document.getElementById("MemberID").value = id;
      return;
    }
    fillForm(res.data);
    window.__loadedMember = id; // ðŸ”‘ update permission
  });
}


</script>


</body>
</html>
