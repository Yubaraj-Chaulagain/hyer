<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Member Registration</title>

<style>
body{font-family:Arial;background:#f2f4f7;padding:10px}
.container{max-width:1200px;margin:auto;background:#fff;padding:16px;border-radius:8px}
h3{background:#2563eb;color:#fff;padding:6px 10px;font-size:14px;border-radius:4px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
label{font-size:12px;font-weight:bold}
input,select,textarea{width:100%;padding:6px;font-size:12px}
textarea{height:40px}
.span2{grid-column:span 2}
.span4{grid-column:span 4}
button{padding:8px;margin-top:10px;font-size:14px;color:#fff;border:none;border-radius:4px;cursor:pointer}
.save{background:#2563eb}
.update{background:#16a34a}
.delete{background:#dc2626}
</style>
</head>

<body>
<div class="container">

<h3>Search Member</h3>
<div class="grid">
  <div>
    <label>MemberID</label>
    <input id="MemberID">
  </div>
  <div>
    <button class="save" onclick="searchMember()">Search</button>
  </div>
</div>

<h3>Member Information</h3>
<div class="grid">
<input id="FullName" placeholder="Full Name">
<input id="FatherName" placeholder="Father Name">
<input id="Husband/wifeName" placeholder="Husband/Wife Name">
<input id="GrandfatherName" placeholder="Grandfather Name">

<input type="date" id="DOB">
<select id="Gender"><option>Male</option><option>Female</option><option>Other</option></select>
<select id="MaritalStatus"><option>Single</option><option>Married</option></select>
<input id="Nationality" value="Nepali">
</div>

<h3>Citizenship</h3>
<div class="grid">
<input id="CitizenshipNo" placeholder="Citizenship No">
<select id="CitizenshipDistrict"></select>
<input type="date" id="CitizenshipIssueDate">
</div>

<h3>Address</h3>
<div class="grid">
<select id="Province"></select>
<select id="District"></select>
<select id="Municipality"></select>
<select id="WardNo"></select>
<input id="PermanentAddress" class="span4" placeholder="Permanent Address">
</div>

<h3>Contact & Membership</h3>
<div class="grid">
<input id="Mobile" placeholder="Mobile">
<input id="Email" placeholder="Email">
<select id="MembershipType"><option>General</option><option>Saving</option><option>Loan</option></select>
<input type="date" id="JoinDate">
<input id="ShareQty">
<input id="ShareAmount">
<input id="MembershipFee">
<select id="MemberStatus"><option>Active</option><option>Inactive</option></select>
</div>

<h3>Nominee</h3>
<div class="grid">
<input id="NomineeName">
<select id="NomineeRelation"><option>Father</option><option>Mother</option><option>Spouse</option></select>
<input id="NomineeCitizenship">
<input id="NomineePhone">
<input id="NomineeAddress" class="span4">
</div>

<h3>System</h3>
<div class="grid">
<select id="Occupation"><option>Business</option><option>Service</option><option>Agriculture</option></select>
<input id="IncomeSource">
<input id="Username" readonly>
<input id="Password" readonly>
<select id="Role"><option>Member</option><option>Staff</option><option>Admin</option></select>
<textarea id="Remarks" class="span4"></textarea>
</div>

<h3>Uploads</h3>
<div class="grid">
<input id="PhotoURL" placeholder="Photo URL">
<input id="CitizenshipFileURL" placeholder="Citizenship File URL">
<input id="SignatureURL" placeholder="Signature URL">
</div>

<button class="save" onclick="saveMember()">Save</button>
<button class="update" onclick="updateMember()">Update</button>
<button class="delete" onclick="deleteMember()">Delete</button>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby8MkFWnl46wU9mDAv-ywz7hxzbVdpTUpZsyWJ-QdtsBnBW42BU3URMo8BlUYsGoASaGw/exec";
const ADMIN_URL = "https://fulkumari.com.np/sheettoweb/nepal-admin-structure.json";
const IMGBB_KEY = "f5d95811959fdcd59c8ea459aadb650b";
let adminData = {};
let loadedId = null;

/* ===== SEARCH ===== */
function searchMember(){
  const id = MemberID.value.trim();
  if(!id) return alert("Enter Member ID");

  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:"search", memberId:id})
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res.found) return alert("Not found");
    Object.keys(res.data).forEach(k=>{
      if(document.getElementById(k))
        document.getElementById(k).value=res.data[k];
    });
    loadedId = id;
  });
}

/* ===== ADD ===== */
function submitForm(){
  if(loadedId) return alert("Use UPDATE");
  send("save");
}

/* ===== UPDATE ===== */
function updateForm(){
  if(!loadedId) return alert("Search first");
  send("save");
}

/* ===== DELETE ===== */
function deleteForm(){
  if(!confirm("Delete?")) return;
  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:"delete",memberId:MemberID.value})
  }).then(()=>alert("Deleted"));
}

/* ===== SEND ===== */
function send(action){
  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action,data:collect()})
  }).then(()=>alert("Success"));
}

function collect(){
  const d={};
  document.querySelectorAll("input,select,textarea")
    .forEach(e=>d[e.id]=e.value);
  return d;
}

/* ===== IMGBB ===== */
function upload(inp,target){
  const r=new FileReader();
  r.onload=()=>{
    fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,{
      method:"POST",
      body:new URLSearchParams({image:r.result.split(",")[1]})
    })
    .then(r=>r.json())
    .then(d=>document.getElementById(target).value=d.data.url);
  };
  r.readAsDataURL(inp.files[0]);
}
</script>


</body>
</html>
