<!DOCTYPE html>
<html>
<body>
<h3>Member Form</h3>

<input id="MemberID" placeholder="Member ID (m001)">
<input id="FullName" placeholder="Full Name">
<input id="FatherName" placeholder="Father Name">
<input id="HusbandName" placeholder="Husband Name">
<input id="Mobile" placeholder="Mobile">
<input id="PhotoURL" placeholder="Photo URL">

<input type="file" onchange="uploadImg(this)">

<button onclick="add()">ADD</button>
<button onclick="search()">SEARCH</button>
<button onclick="update()">UPDATE</button>

<script>
const API = "https://script.google.com/macros/s/AKfycbwSerY99FxqEzEh8UEQfjfnp7yW1Vj91Iet1etuv_dW5M3apPjpV_3SCM2Q7Qus4rOswg/exec";
const IMGBB_KEY = "f5d95811959fdcd59c8ea459aadb650b";

function data(){
 let d={action:""};
 document.querySelectorAll("input").forEach(i=>{
   d[i.id]=i.value;
 });
 d.Username=d.MemberID;
 d.Password=d.Mobile;
 d.Role="MEMBER";
 return d;
}

function add(){
 let d=data(); d.action="add";
 send(d);
}

function search(){
 let id=document.getElementById("MemberID").value;
 send({action:"search",MemberID:id},res=>{
   if(res.status){
     Object.keys(res.data).forEach(k=>{
       let el=document.getElementById(k);
       if(el) el.value=res.data[k];
     });
   }
 });
}

function update(){
 let d=data(); d.action="update";
 send(d);
}

function send(d,cb){
 fetch(API,{method:"POST",body:JSON.stringify(d)})
 .then(r=>r.json()).then(r=>{
   alert(JSON.stringify(r));
   if(cb)cb(r);
 });
}

function uploadImg(f){
 let fd=new FormData();
 fd.append("image",f.files[0]);
 fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,{
   method:"POST",body:fd
 }).then(r=>r.json()).then(d=>{
   document.getElementById("PhotoURL").value=d.data.url;
 });
}
</script>
</body>
</html>
