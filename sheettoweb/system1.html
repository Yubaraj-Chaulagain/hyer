<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Member Registration</title>

<style>
body{font-family:Arial;background:#f2f4f7;padding:10px}
.container{max-width:1200px;margin:auto;background:#fff;padding:16px;border-radius:8px}
h3{background:#2563eb;color:#fff;padding:6px 10px;font-size:14px;border-radius:4px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
label{font-size:12px;font-weight:bold}
input,select,textarea{width:100%;padding:6px;font-size:12px}
textarea{height:40px}
.span2{grid-column:span 2}
.span4{grid-column:span 4}
button{padding:8px;margin-top:10px;font-size:14px;color:#fff;border:none;border-radius:4px;cursor:pointer}
.save{background:#2563eb}
.update{background:#16a34a}
.delete{background:#dc2626}
</style>
</head>

<body>
<div class="container">

<h3>Search Member</h3>
<div class="grid">
  <div>
    <label>MemberID</label>
    <input id="MemberID">
  </div>
  <div>
    <button class="save" onclick="searchMember()">Search</button>
  </div>
</div>

<h3>Member Information</h3>
<div class="grid">
<input id="FullName" placeholder="Full Name">
<input id="FatherName" placeholder="Father Name">
<input id="Husband/wifeName" placeholder="Husband/Wife Name">
<input id="GrandfatherName" placeholder="Grandfather Name">

<input type="date" id="DOB">
<select id="Gender"><option>Male</option><option>Female</option><option>Other</option></select>
<select id="MaritalStatus"><option>Single</option><option>Married</option></select>
<input id="Nationality" value="Nepali">
</div>

<h3>Citizenship</h3>
<div class="grid">
<input id="CitizenshipNo" placeholder="Citizenship No">
<select id="CitizenshipDistrict"></select>
<input type="date" id="CitizenshipIssueDate">
</div>

<h3>Address</h3>
<div class="grid">
<select id="Province"></select>
<select id="District"></select>
<select id="Municipality"></select>
<select id="WardNo"></select>
<input id="PermanentAddress" class="span4" placeholder="Permanent Address">
</div>

<h3>Contact & Membership</h3>
<div class="grid">
<input id="Mobile" placeholder="Mobile">
<input id="Email" placeholder="Email">
<select id="MembershipType"><option>General</option><option>Saving</option><option>Loan</option></select>
<input type="date" id="JoinDate">
<input id="ShareQty">
<input id="ShareAmount">
<input id="MembershipFee">
<select id="MemberStatus"><option>Active</option><option>Inactive</option></select>
</div>

<h3>Nominee</h3>
<div class="grid">
<input id="NomineeName">
<select id="NomineeRelation"><option>Father</option><option>Mother</option><option>Spouse</option></select>
<input id="NomineeCitizenship">
<input id="NomineePhone">
<input id="NomineeAddress" class="span4">
</div>

<h3>System</h3>
<div class="grid">
<select id="Occupation"><option>Business</option><option>Service</option><option>Agriculture</option></select>
<input id="IncomeSource">
<input id="Username" readonly>
<input id="Password" readonly>
<select id="Role"><option>Member</option><option>Staff</option><option>Admin</option></select>
<textarea id="Remarks" class="span4"></textarea>
</div>

<h3>Uploads</h3>
<div class="grid">
<input id="PhotoURL" placeholder="Photo URL">
<input id="CitizenshipFileURL" placeholder="Citizenship File URL">
<input id="SignatureURL" placeholder="Signature URL">
</div>

<button class="save" onclick="saveMember()">Save</button>
<button class="update" onclick="updateMember()">Update</button>
<button class="delete" onclick="deleteMember()">Delete</button>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxcusrJFzAtSRts0zJRjcyOSr4hhuRlFL6jvWUFPdRerG3mg09Clfs0L2nVKxzRkZFH7A/exec";
const ADMIN_URL = "https://fulkumari.com.np/sheettoweb/nepal-admin-structure.json";
let adminData = {};
let loaded=false;

/* ---------- ADMIN DATA ---------- */
fetch(ADMIN_URL).then(r=>r.json()).then(d=>{
  adminData=d;
  Province.innerHTML='<option></option>';
  Object.keys(d).forEach(p=>Province.innerHTML+=`<option>${p}</option>`);

  const dist=new Set();
  Object.values(d).forEach(p=>Object.keys(p).forEach(x=>dist.add(x)));
  CitizenshipDistrict.innerHTML='<option></option>';
  [...dist].sort().forEach(x=>CitizenshipDistrict.innerHTML+=`<option>${x}</option>`);
});

Province.onchange=()=>{District.innerHTML='<option></option>';Object.keys(adminData[Province.value]||{}).forEach(d=>District.innerHTML+=`<option>${d}</option>`);}
District.onchange=()=>{Municipality.innerHTML='<option></option>';(adminData[Province.value][District.value]||[]).forEach(m=>Municipality.innerHTML+=`<option>${m}</option>`);}
for(let i=1;i<=35;i++)WardNo.innerHTML+=`<option>${i}</option>`;

/* ---------- CORE ---------- */
function collect(){
 const o={};
 document.querySelectorAll("input,select,textarea").forEach(e=>o[e.id]=e.value);
 o.Username=o.MemberID;
 o.Password=o.Mobile;
 return o;
}

function searchMember(){
 fetch(API_URL,{method:"POST",body:JSON.stringify({action:"get",memberId:MemberID.value})})
 .then(r=>r.json()).then(res=>{
   if(!res.found) return alert("Not found");
   Object.keys(res.data).forEach(k=>document.getElementById(k)&&(document.getElementById(k).value=res.data[k]));
   loaded=true;
 });
}

function saveMember(){
 if(loaded) return alert("Use UPDATE");
 fetch(API_URL,{method:"POST",body:JSON.stringify({action:"save",data:collect()})})
 .then(()=>alert("Saved"));
}

function updateMember(){
 if(!loaded) return alert("Search first");
 fetch(API_URL,{method:"POST",body:JSON.stringify({action:"save",data:collect()})})
 .then(()=>alert("Updated"));
}

function deleteMember(){
 if(!confirm("Delete?"))return;
 fetch(API_URL,{method:"POST",body:JSON.stringify({action:"delete",memberId:MemberID.value})})
 .then(()=>alert("Deleted"));
}
</script>

</body>
</html>
