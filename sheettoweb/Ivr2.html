<!DOCTYPE html>
<html>
<head>
<title>Member & Finance System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<style>
td a { text-decoration:none; }
</style>
</head>
<body class="p-3">

<!-- ===== LOGIN ===== -->
<div id="loginDiv">
  <h3>Login</h3>
  <input id="username" class="form-control mb-2" placeholder="Username">
  <input id="password" type="password" class="form-control mb-2" placeholder="Password">
  <button class="btn btn-primary" onclick="login()">Login</button>
</div>

<!-- ===== MAIN APP ===== -->
<div id="mainDiv" style="display:none;">
<h3>Member & Finance System</h3>

<ul class="nav nav-tabs mb-2" id="tabs">
  <li class="nav-item"><a class="nav-link active" href="#" onclick="showTab('membersTab')">Members</a></li>
  <li class="nav-item" id="usersTabBtn"><a class="nav-link" href="#" onclick="showTab('usersTab')">Users</a></li>
  <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('itemsTab')">Items</a></li>
  <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('transactionsTab')">Transactions</a></li>
  <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('balanceTab')">Balance</a></li>
  <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('loansTab')">Loans</a></li>
</ul>

<div id="tabsContent">

<!-- MEMBERS TAB -->
<div id="membersTab">
  <button class="btn btn-success mb-2" onclick="openAdd()" id="btnAdd">+ Add Member</button>
  <input class="form-control mb-2" id="search" placeholder="Search members">
  <table class="table table-bordered table-sm table-hover">
    <thead class="table-dark">
      <tr>
        <th>ID</th><th>Name</th><th>Address</th><th>Father</th><th>Grand Father</th>
        <th>Spouse</th><th>Phone</th><th>Email</th>
        <th>ID Photo</th><th>Member Photo</th>
        <th>Status</th><th>OTP</th><th>Entry Date</th><th>Action</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<!-- USERS TAB -->
<div id="usersTab" style="display:none;">
  <button class="btn btn-success mb-2" onclick="openAddUser()">+ Add User</button>
  <table class="table table-bordered table-sm table-hover">
    <thead class="table-dark">
      <tr><th>Username</th><th>Password</th><th>Role</th><th>MemberID</th><th>Action</th></tr>
    </thead>
    <tbody id="tbodyUsers"></tbody>
  </table>
</div>

<!-- ITEMS TAB -->
<div id="itemsTab" style="display:none;">
  <button class="btn btn-success mb-2" onclick="openAddItem()">+ Add Item</button>
  <table class="table table-bordered table-sm table-hover">
    <thead class="table-dark">
      <tr><th>ItemID</th><th>Name</th><th>Price</th><th>Quantity</th><th>Action</th></tr>
    </thead>
    <tbody id="tbodyItems"></tbody>
  </table>
</div>

<!-- TRANSACTIONS TAB -->
<div id="transactionsTab" style="display:none;">
  <button class="btn btn-success mb-2" onclick="openTransaction()">+ New Transaction</button>
  <table class="table table-bordered table-sm table-hover">
    <thead class="table-dark">
      <tr><th>TxnID</th><th>MemberID</th><th>Type</th><th>Amount</th><th>Details</th><th>PaymentType</th><th>Date</th></tr>
    </thead>
    <tbody id="tbodyTransactions"></tbody>
  </table>
</div>

<!-- BALANCE TAB -->
<div id="balanceTab" style="display:none;">
  <h5>Member Balance</h5>
  <table class="table table-bordered table-sm">
    <thead class="table-dark">
      <tr><th>MemberID</th><th>Balance</th><th>Action</th></tr>
    </thead>
    <tbody id="tbodyBalance"></tbody>
  </table>
</div>

<!-- LOANS TAB -->
<div id="loansTab" style="display:none;">
  <button class="btn btn-success mb-2" onclick="openAddLoan()">+ Add Loan</button>
  <table class="table table-bordered table-sm table-hover">
    <thead class="table-dark">
      <tr><th>LoanID</th><th>MemberID</th><th>Amount</th><th>Paid</th><th>Monthly Payment</th><th>Remaining</th><th>NextDueDate</th><th>Action</th></tr>
    </thead>
    <tbody id="tbodyLoans"></tbody>
  </table>
</div>

</div>

<!-- ===== MODALS ===== -->
<!-- MEMBER MODAL -->
<div class="modal fade" id="memberModal">
<div class="modal-dialog modal-xl"><div class="modal-content">
<div class="modal-header"><h5 id="modalTitle"></h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
<div class="modal-body row g-2">
  <input id="MemberID" class="form-control col-6" placeholder="Member ID">
  <input id="Name" class="form-control col-6" placeholder="Name">
  <input id="Address" class="form-control col-6" placeholder="Address">
  <input id="FatherName" class="form-control col-6" placeholder="Father Name">
  <input id="GrandFatherName" class="form-control col-6" placeholder="Grand Father Name">
  <input id="SpouseName" class="form-control col-6" placeholder="Spouse/Wife Name">
  <input id="Phone" class="form-control col-6" placeholder="Phone">
  <input id="Email" class="form-control col-6" placeholder="Email">
  <input id="IdentityPhotoURL" class="form-control col-6" placeholder="Identity Photo URL">
  <input id="MemberPhotoURL" class="form-control col-6" placeholder="Member Photo URL">
  <input id="Status" class="form-control col-6" placeholder="Status">
  <input id="OTP" class="form-control col-6" placeholder="OTP">
  <input id="EntryDate" type="date" class="form-control col-6">
</div>
<div class="modal-footer">
  <button class="btn btn-success" onclick="save()">Save</button>
  <button class="btn btn-danger" onclick="remove()">Delete</button>
</div>
</div></div>
</div>

<!-- USER MODAL -->
<div class="modal fade" id="userModal">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header"><h5>User</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
<div class="modal-body">
<input id="UUsername" class="form-control mb-2" placeholder="Username">
<input id="UPassword" class="form-control mb-2" placeholder="Password">
<select id="URole" class="form-control mb-2">
<option value="admin">Admin</option>
<option value="user">User</option>
<option value="member">Member</option>
</select>
<input id="UMemberID" class="form-control mb-2" placeholder="MemberID (optional)">
</div>
<div class="modal-footer">
<button class="btn btn-success" onclick="saveUser()">Save</button>
<button class="btn btn-danger" onclick="deleteUser()">Delete</button>
</div>
</div></div>
</div>

<!-- ITEM MODAL -->
<div class="modal fade" id="itemModal">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header"><h5>Item</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
<div class="modal-body">
<input id="ItemID" class="form-control mb-2" placeholder="Item ID">
<input id="ItemName" class="form-control mb-2" placeholder="Name">
<input id="ItemPrice" class="form-control mb-2" placeholder="Price">
<input id="ItemQuantity" class="form-control mb-2" placeholder="Quantity">
</div>
<div class="modal-footer">
<button class="btn btn-success" onclick="saveItem()">Save</button>
</div>
</div></div>
</div>

<!-- TRANSACTION MODAL -->
<div class="modal fade" id="transactionModal">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header"><h5>Transaction</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
<div class="modal-body">
<select id="TxnType" class="form-control mb-2">
<option value="Deposit">Deposit</option>
<option value="Withdraw">Withdraw</option>
<option value="Transfer">Transfer</option>
<option value="Invoice">Invoice</option>
<option value="Loan">Loan</option>
</select>
<input id="TxnAmount" type="number" class="form-control mb-2" placeholder="Amount">
<input id="TxnDetails" class="form-control mb-2" placeholder="Details / To MemberID">
<select id="PaymentType" class="form-control mb-2">
<option value="Cash">Cash</option>
<option value="Bank">Bank</option>
</select>
</div>
<div class="modal-footer">
<button class="btn btn-success" onclick="saveTransaction()">Save</button>
</div>
</div></div>
</div>

<!-- LOAN MODAL -->
<div class="modal fade" id="loanModal">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header"><h5>Loan</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
<div class="modal-body">
<input id="LoanMemberID" class="form-control mb-2" placeholder="MemberID">
<input id="LoanAmount" type="number" class="form-control mb-2" placeholder="Loan Amount">
<input id="LoanMonths" type="number" class="form-control mb-2" placeholder="Months">
</div>
<div class="modal-footer">
<button class="btn btn-success" onclick="saveLoan()">Save Loan</button>
</div>
</div></div>
</div>

<script>
// ================= JS CODE FOR ALL TABS =================
const API="https://script.google.com/macros/s/AKfycbz_WvV9mrVEyxQxYaOkPlHtKUaJQWL2WogzjcQ8Ptu7fHCA5wo4XbbBwb_6sDOqSfzevQ/exec"; // replace with your Apps Script URL
let members=[], users=[], items=[], transactions=[], loans=[], role="", currentUsername="", currentMemberID="";
const modal=new bootstrap.Modal(memberModal), userModalInstance=new bootstrap.Modal(userModal),
txnModalInstance=new bootstrap.Modal(transactionModal), loanModalInstance=new bootstrap.Modal(loanModal);
let editMode=false, editItemMode=false;

// ===== LOGIN =====
function login(){ fetch(API,{method:"POST",body:JSON.stringify({action:"login",username:username.value,password:password.value})})
.then(r=>r.json()).then(res=>{if(res.status){role=res.role;currentUsername=username.value;currentMemberID=res.MemberID;loginDiv.style.display="none";mainDiv.style.display="block";if(role!=="admin") usersTabBtn.style.display="none"; loadMembers(); loadItems(); loadTransactions(); loadBalance(); loadLoans();}else alert(res.message);}); }

function showTab(tab){ document.querySelectorAll('#tabsContent > div').forEach(d=>d.style.display='none'); document.getElementById(tab).style.display='block'; }

// ===== MEMBERS (same as previous) =====
// ... include Members JS code from previous step ...

// ===== USERS, ITEMS, TRANSACTIONS, BALANCE, LOANS JS =====
// Use the JS code I gave in the previous step for all these tabs
</script>
</body>
</html>
