<div class="box">
<h2>ðŸ’¬ Live Chat</h2>
<div id="chatbox" style="height:300px;overflow:auto;background:#f9f9f9;padding:10px;border:1px solid gray"></div>
<input id="msg" placeholder="Message">
<button onclick="send()">Send</button>
</div>

<script>
// ===== Apps Script URL =====
const API = "https://script.google.com/macros/s/AKfycbwC5oxFg2G4sOnX_YElEKbIaLmneVSenAnxNvAXitophPsM7RBT2JGsN4X_mjBxKIremg/exec";

let userName = document.getElementById("lid").value || "Guest";

// ===== SEND CHAT =====
function send(){
 let msg = document.getElementById("msg").value;
 if(msg.trim()=="") return;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({
    action:"chat",
    from:userName,
    to:"All",
    msg:msg
  })
 })
 .then(res=>res.text())
 .then(t=>{
   document.getElementById("msg").value="";
   getChat();
 });
}

// ===== GET CHAT =====
function getChat(){
 fetch(API)
 .then(res=>res.json())
 .then(data=>{
   let html = "";
   data.forEach((row,i)=>{
     if(i===0) return; // skip header
     html += "<p><b>"+row[1]+":</b> "+row[3]+"</p>";
   });
   document.getElementById("chatbox").innerHTML = html;
   document.getElementById("chatbox").scrollTop = document.getElementById("chatbox").scrollHeight;
 })
}

// ===== AUTO REFRESH EVERY 3 SEC =====
setInterval(getChat,3000);
</script>
