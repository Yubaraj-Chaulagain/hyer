<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yubaraj Chaulagai Calling Website</title>
<style>
body{
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 0;
  text-align: center;
}
h1,h2{
  color:#333;
}
.container{
  max-width: 500px;
  margin: 10px auto;
  padding: 20px;
}
.box{
  background:white;
  padding:20px;
  margin:15px 0;
  border-radius:10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
input,button{
  padding:12px;
  margin:5px 0;
  width: 90%;
  max-width: 400px;
  font-size:16px;
  border-radius:5px;
  border:1px solid #ccc;
  box-sizing: border-box;
}
button{
  background:#007bff;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover{
  background:#0056b3;
}
#chatbox{
  height:200px;
  overflow:auto;
  border:1px solid gray;
  padding:10px;
  text-align:left;
  background:#f9f9f9;
}
iframe{
  width:100%;
  height:400px;
  border:none;
  border-radius:10px;
}
@media(max-width:480px){
  iframe{height:300px;}
  input,button{font-size:14px;padding:10px;}
}
</style>
</head>
<body>

<div class="container">
<h1>üìû Yubaraj Chaulagai Calling Website</h1>

<div class="box">
<h2>‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§¶‡§∞‡•ç‡§§‡§æ</h2>
<input id="rid" placeholder="Member ID"><br>
<input id="rname" placeholder="‡§®‡§æ‡§Æ"><br>
<input id="remail" placeholder="Email"><br>
<input id="rpass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°"><br>
<button onclick="register()">‡§¶‡§∞‡•ç‡§§‡§æ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
</div>

<div class="box">
<h2>‡§≤‡§ó‡§á‡§®</h2>
<input id="lid" placeholder="Member ID"><br>
<input id="lpass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°"><br>
<input id="lemail" placeholder="Email OTP ‡§™‡§†‡§æ‡§â‡§®"><br>
<button onclick="sendOTP()">OTP ‡§™‡§†‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button><br>
<input id="otp" placeholder="OTP ‡§ï‡•ã‡§°"><br>
<button onclick="login()">‡§≤‡§ó‡§á‡§®</button>
</div>

<div id="dashboard" style="display:none">

<div class="box">
<h2>üí¨ Live Chat</h2>
<div id="chatbox"></div>
<input id="msg" placeholder="Message">
<button onclick="send()">Send</button>
</div>

<div class="box">
<h2>üé• Group Video Call</h2>
<iframe
src="https://meet.jit.si/YubarajChaulagaiRoom"
allow="camera; microphone; fullscreen;">
</iframe>
</div>

</div>

<script>
// ===== Apps Script URL =====
const API = "https://script.google.com/macros/s/AKfycbwC5oxFg2G4sOnX_YElEKbIaLmneVSenAnxNvAXitophPsM7RBT2JGsN4X_mjBxKIremg/exec";

// ===== REGISTER =====
function register(){
 let data = new URLSearchParams({
  action:"register",
  id:document.getElementById("rid").value,
  name:document.getElementById("rname").value,
  email:document.getElementById("remail").value,
  pass:document.getElementById("rpass").value
 });
 fetch(API,{method:"POST",body:data})
 .then(res=>res.text())
 .then(t=>alert(t));
}

// ===== SEND OTP =====
function sendOTP(){
 let email = document.getElementById("lemail").value;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"sendOTP",email:email})
 })
 .then(res=>res.text())
 .then(t=>alert(t));
}

// ===== LOGIN =====
function login(){
 let id = document.getElementById("lid").value;
 let pass = document.getElementById("lpass").value;
 let otp = document.getElementById("otp").value;
 let email = document.getElementById("lemail").value;

 // Verify OTP first
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"verifyOTP",email:email,otp:otp})
 })
 .then(res=>res.text())
 .then(t=>{
   if(t=="OTP OK"){
     // Check login
     fetch(API,{
       method:"POST",
       body:new URLSearchParams({action:"login",id:id,pass:pass})
     })
     .then(res=>res.text())
     .then(tt=>{
       if(tt=="OK"){
         alert("‡§≤‡§ó‡§á‡§® ‡§∏‡§´‡§≤ ‡§≠‡§Ø‡•ã")
         document.getElementById("dashboard").style.display="block";
       } else alert("‡§ó‡§≤‡§§ Member ID ‡§µ‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°")
     })
   } else alert("‡§ó‡§≤‡§§ OTP")
 })
}

// ===== SEND CHAT =====
function send(){
 let msg = document.getElementById("msg").value;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({
    action:"chat",
    from:document.getElementById("lid").value,
    to:"All",
    msg:msg.value
  })
 })
 .then(res=>res.text())
 .then(t=>{
   document.getElementById("chatbox").innerHTML += "<p>"+msg+"</p>";
   document.getElementById("msg").value="";
 })
}
</script>

</body>
</html>
