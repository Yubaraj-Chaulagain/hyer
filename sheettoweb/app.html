<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Yubaraj Chaulagai Calling Website</title>
<style>
body{font-family:Arial;background:#f2f2f2;text-align:center}
.box{background:white;padding:20px;margin:20px;border-radius:10px}
input,button{padding:10px;margin:5px}
#chatbox{height:200px;overflow:auto;border:1px solid gray;padding:10px}
</style>
</head>
<body>

<h1>ЁЯУЮ Yubaraj Chaulagai Calling Website</h1>

<div class="box">
<h2>рд╕рджрд╕реНрдп рджрд░реНрддрд╛</h2>
<input id="rid" placeholder="Member ID"><br>
<input id="rname" placeholder="рдирд╛рдо"><br>
<input id="remail" placeholder="Email"><br>
<input id="rpass" placeholder="рдкрд╛рд╕рд╡рд░реНрдб"><br>
<button onclick="register()">рджрд░реНрддрд╛ рдЧрд░реНрдиреБрд╣реЛрд╕реН</button>
</div>

<div class="box">
<h2>рд▓рдЧрдЗрди</h2>
<input id="lid" placeholder="Member ID"><br>
<input id="lpass" placeholder="рдкрд╛рд╕рд╡рд░реНрдб"><br>
<input id="lemail" placeholder="Email OTP рдкрдард╛рдЙрди"><br>
<button onclick="sendOTP()">OTP рдкрдард╛рдЙрдиреБрд╣реЛрд╕реН</button><br>
<input id="otp" placeholder="OTP рдХреЛрдб"><br>
<button onclick="login()">рд▓рдЧрдЗрди</button>
</div>

<div id="dashboard" style="display:none">

<div class="box">
<h2>ЁЯТм Live Chat</h2>
<div id="chatbox"></div>
<input id="msg" placeholder="Message">
<button onclick="send()">Send</button>
</div>

<div class="box">
<h2>ЁЯОе Group Video Call</h2>
<iframe
src="https://meet.jit.si/YubarajChaulagaiRoom"
width="100%" height="500">
</iframe>
</div>

</div>

<script>
// ===== Apps Script URL =====
const API = "https://script.google.com/macros/s/AKfycbwC5oxFg2G4sOnX_YElEKbIaLmneVSenAnxNvAXitophPsM7RBT2JGsN4X_mjBxKIremg/exec";

// ===== REGISTER =====
function register(){
 let data = new URLSearchParams({
  action:"register",
  id:document.getElementById("rid").value,
  name:document.getElementById("rname").value,
  email:document.getElementById("remail").value,
  pass:document.getElementById("rpass").value
 });
 fetch(API,{method:"POST",body:data})
 .then(res=>res.text())
 .then(t=>alert(t));
}

// ===== SEND OTP =====
function sendOTP(){
 let email = document.getElementById("lemail").value;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"sendOTP",email:email})
 })
 .then(res=>res.text())
 .then(t=>alert(t));
}

// ===== LOGIN =====
function login(){
 let id = document.getElementById("lid").value;
 let pass = document.getElementById("lpass").value;
 let otp = document.getElementById("otp").value;
 let email = document.getElementById("lemail").value;

 // Verify OTP first
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({action:"verifyOTP",email:email,otp:otp})
 })
 .then(res=>res.text())
 .then(t=>{
   if(t=="OTP OK"){
     // Check login
     fetch(API,{
       method:"POST",
       body:new URLSearchParams({action:"login",id:id,pass:pass})
     })
     .then(res=>res.text())
     .then(tt=>{
       if(tt=="OK"){
         alert("рд▓рдЧрдЗрди рд╕рдлрд▓ рднрдпреЛ")
         document.getElementById("dashboard").style.display="block";
       } else alert("рдЧрд▓рдд Member ID рд╡рд╛ рдкрд╛рд╕рд╡рд░реНрдб")
     })
   } else alert("рдЧрд▓рдд OTP")
 })
}

// ===== SEND CHAT =====
function send(){
 let msg = document.getElementById("msg").value;
 fetch(API,{
  method:"POST",
  body:new URLSearchParams({
    action:"chat",
    from:document.getElementById("lid").value,
    to:"All",
    msg:msg
  })
 })
 .then(res=>res.text())
 .then(t=>{
   document.getElementById("chatbox").innerHTML += "<p>"+msg+"</p>";
   document.getElementById("msg").value="";
 })
}
</script>

</body>
</html>
