<!DOCTYPE html>
<html>
<head>
<title>Member Finance System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="p-3">

<div id="loginDiv">
  <h4>Login</h4>
  <input id="username" class="form-control mb-2" placeholder="Username">
  <input id="password" type="password" class="form-control mb-2" placeholder="Password">
  <button class="btn btn-primary" onclick="login()">Login</button>
</div>

<div id="mainDiv" style="display:none;">
<h4>Member & Finance System</h4>

<ul class="nav nav-tabs mb-3">
  <li class="nav-item"><a class="nav-link active" onclick="tab('members')">Members</a></li>
  <li class="nav-item"><a class="nav-link" onclick="tab('users')">Users</a></li>
  <li class="nav-item"><a class="nav-link" onclick="tab('items')">Items</a></li>
  <li class="nav-item"><a class="nav-link" onclick="tab('transactions')">Transactions</a></li>
  <li class="nav-item"><a class="nav-link" onclick="tab('balance')">Balance</a></li>
  <li class="nav-item"><a class="nav-link" onclick="tab('loans')">Loans</a></li>
</ul>

<div id="content"></div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbwTPCUTeGRtMrd2gS-cuwfYJ2Tm_ozPMzr12R4fMXEVJEz10I0-uRHJ4oRuM6TnYcC4/exec";
let role="",memberID="";

function tab(t){
  if(t==="members") load("getMembers","Members");
  if(t==="users") load("getUsers","Users");
  if(t==="items") load("getItems","Items");
  if(t==="transactions") load("getTransactions","Transactions");
  if(t==="balance") load("getBalance","Balance");
  if(t==="loans") load("getLoans","Loans");
}

function login(){
 fetch(API,{method:"POST",body:JSON.stringify({
  action:"login",
  username:username.value,
  password:password.value
 })})
 .then(r=>r.json()).then(d=>{
   if(d.status){
     role=d.role; memberID=d.MemberID;
     loginDiv.style.display="none";
     mainDiv.style.display="block";
     tab("members");
   } else alert(d.message);
 });
}

function load(action,title){
 fetch(API,{method:"POST",body:JSON.stringify({action})})
 .then(r=>r.json()).then(d=>{
   let h=`<h5>${title}</h5><table class="table table-bordered table-sm"><tr>`;
   if(!d.length){content.innerHTML="No data";return;}
   Object.keys(d[0]).forEach(k=>h+=`<th>${k}</th>`);
   h+="</tr>";
   d.forEach(r=>{
     h+="<tr>";
     Object.values(r).forEach(v=>h+=`<td>${v}</td>`);
     h+="</tr>";
   });
   h+="</table>";
   content.innerHTML=h;
 });
}
</script>
</body>
</html>
